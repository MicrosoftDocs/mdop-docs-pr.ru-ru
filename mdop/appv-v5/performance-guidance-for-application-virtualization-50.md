---
title: Рекомендации по производительности для Application Virtualization 5.0
description: Рекомендации по производительности для Application Virtualization 5.0
author: dansimp
ms.assetid: 6b3a3255-b957-4b9b-8bfc-a93fe8438a81
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, appcompat, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 08/30/2016
ms.openlocfilehash: 3b0f5ef07935fc34adce772e7b2fff85a12b01dc
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/26/2020
ms.locfileid: "10813536"
---
# Рекомендации по производительности для Application Virtualization 5.0


В этой статье описано, как настроить App-V 5,0 для оптимальной производительности, оптимизировать пакеты виртуальных приложений и обеспечить более эффективное взаимодействие с пользователями с помощью RDS и VDI.

Реализация нескольких методов поможет вам улучшить взаимодействие с конечными пользователями. Однако ваша среда может не поддерживать все методы.

Прежде чем читать этот документ, вы должны прочитать и понять следующие данные.

-   [Руководство администратора Microsoft Application Virtualization 5,0](microsoft-application-virtualization-50-administrators-guide.md)

-   [Публикация приложений для App-V 5 SP2 и взаимодействие с клиентами](https://go.microsoft.com/fwlink/?LinkId=395206)

-   [Руководство по упорядочению приложений Microsoft Application Virtualization 5,0](https://go.microsoft.com/fwlink/?LinkId=269953)

**Примечание.**  
Некоторые термины, используемые в этом документе, могут иметь различные значения в зависимости от внешнего источника и контекста. Для получения дополнительных сведений об условиях, используемых в этом документе, а также звездочки **\\** *, ознакомьтесь с разделом терминология, посвященной [производительности виртуализации приложений](#bkmk-terms1) .



Наконец, этот документ предоставит вам информацию о том, как настроить компьютер под управлением клиента App-V 5,0 и среды для обеспечения оптимальной производительности. Оптимизируйте виртуальные пакеты приложений для повышения производительности с помощью секвенсора и Узнайте, как использовать виртуализацию взаимодействия с пользователем (UE-V) или другие технологии управления пользовательской средой для обеспечения оптимального взаимодействия с пользователем с помощью App-V 5,0 в службах удаленных рабочих столов и неустойчивой инфраструктуры виртуальных рабочих столов (VDI).

Чтобы определить, какая информация важна для вашей среды, ознакомьтесь с кратким обзором и контрольным списком применимости каждого раздела.

## <a href="" id="---------app-v-5-0-in-stateful--non-persistent-deployments"></a> App-V 5,0 в неустойчивых развертываниях с сохранением состояния


В этом разделе приводятся сведения о том, как сделать так, чтобы пользователь получит доступ ко всем виртуальным приложениям в течение секунд после входа. Это достигается посредством уникальной адресации часто выполняемого обновления публикации App-V 5,0. Как вы узнаете о том, что самый быстрый обновленный вариант, но не обязательно ничего делать. Для обеспечения оптимального взаимодействия с пользователем должны выполняться некоторые условия, а также пошаговые инструкции.

Чтобы получить дополнительные сведения, воспользуйтесь приведенными ниже сведениями.

[Сценарии использования](#bkmk-us) : при просмотре двух сценариев имейте в виду, что эти подходы являются крайними. В соответствии с требованиями к использованию вы можете применить эти действия к подмножеству пользователей и/или виртуальных пакетов приложений.

-   Оптимизировано для повышения производительности – для обеспечения оптимального взаимодействия можно ожидать, что основной образ включает некоторые пакеты виртуальных приложений App-V. Эти и другие требования обсуждаются.

-   Оптимизировано для хранения — если вы собираетесь повлиять на хранение, следует рассмотреть этот сценарий, который поможет вам решить эти проблемы.

[Подготовка среды](#bkmk-pe)

-   Действия для подготовки базового образа (в непостоянном окружении VDI или узлов сеансов удаленных рабочих столов) для включения этого подхода необходимо выполнить в базовом образе только несколько шагов.

-   Использование UE-V 2,0 в качестве решения для управления профилями пользователей (UPM) для подхода App-V — это возможность, с помощью которой можно сохранить содержимое всего лишь нескольких разделов реестра и файлов. Эти расположения образуют пользовательские интеграции \ *. Не забудьте ознакомиться с определенными требованиями для решения UPM.

[Руководство по работе с пользователем](#bkmk-uewt)

-   Пошаговое руководство — это пошаговое руководство по операциям App-V и UE-V, а также ожиданиям пользователей.

-   Результат — описывает ожидаемые результаты.

[Влияние на жизненный цикл пакета](#bkmk-plc)

[Улучшение возможностей VDI с помощью оптимизации и настройки производительности](#bkmk-evdi)

### <a href="" id="applicability-checklist-"></a>Контрольный список применимости

Среда развертывания

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><img src="images/checklistbox.gif" alt="Checklist box" /></td>
<td align="left"><p>Несохраняемый VDI или сеансы сеансов.</p></td>
</tr>
<tr class="even">
<td align="left"><img src="images/checklistbox.gif" alt="Checklist box" /></td>
<td align="left"><p>Виртуализация взаимодействия с пользователем (UE-V), другие решения UPM или диски профилей пользователей (UPD).</p></td>
</tr>
</tbody>
</table>



Ожидаемая конфигурация

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><img src="images/checklistbox.gif" alt="Checklist box" /></td>
<td align="left"><p>Виртуализация взаимодействия с пользователем (UE-V) с включенным шаблоном состояния пользователя App-V или программным обеспечением управления профилями пользователей (UPM). Программное обеспечение, поддерживающее UE-V UPM, должно быть способно инициироваться при входе или запуске процесса/приложения и выходе из него.</p></td>
</tr>
<tr class="even">
<td align="left"><img src="images/checklistbox.gif" alt="Checklist box" /></td>
<td align="left"><p>Для App-V (SCS) настроено или настроено хранилище общих данных.</p></td>
</tr>
</tbody>
</table>



ИТ – администрирование

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><img src="images/checklistbox.gif" alt="Checklist box" /></td>
<td align="left"><p>Администратору может потребоваться регулярно обновлять базовое изображение виртуальной машины, чтобы обеспечить оптимальную производительность или администратору для управления несколькими изображениями для разных групп пользователей.</p></td>
</tr>
</tbody>
</table>



### <a href="" id="bkmk-us"></a>Сценарий использования

При просмотре двух сценариев имейте в виду, что эти подходы являются крайними. В соответствии с требованиями к использованию вы можете применить эти действия к подмножеству пользователей, виртуальным пакетам приложений или обоим требованиям.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Оптимизировано для повышения производительности</th>
<th align="left">Оптимизировано для хранения</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Для обеспечения оптимального взаимодействия с пользователем этот подход использует возможности решения UPM и требует дополнительной подготовки изображения и может привести к некоторым дополнительным издержкам на Управление изображениями.</p>
<p>Ниже описано множество улучшений производительности для неустойчивых развертываний с сохранением состояния. Дополнительные сведения можно найти в <strong> разделе Упорядочение шагов, которые помогут вам оптимизировать пакеты для публикации </strong> , а также ссылку на <strong> руководство по упорядочению для App-V 5,0 </strong> на странице "ознакомьтесь с <strong> разделом" в этом документе </strong> .</p></td>
<td align="left"><p>Общие предположения в предыдущем сценарии по-прежнему применимы. Однако имейте в виду, что образы виртуальных машин обычно хранятся в очень дорогостоящих массивах; для этого подхода была выполнена незначительная процедура изменения. Не заполняйте предварительную настройку виртуальных пакетов приложений, предназначенных для пользователей, в базовом образе.</p>
<p>Влияние этого изменения подробно описано в разделе Краткое руководство по работе с пользователем в этом документе.</p></td>
</tr>
</tbody>
</table>



### <a href="" id="bkmk-pe"></a>Подготовка среды

В следующей таблице приведены необходимые шаги для подготовки базового образа и UE-V или другого решения UPM для этого подхода.

**Подготовка базового образа**

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Оптимизировано для повышения производительности</th>
<th align="left">Оптимизировано для хранения</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p></p>
<ul>
<li><p>Установите пакет исправлений 4 (SP4) для клиента Application Virtualization 5,0 версии клиента.</p></li>
<li><p>Установите UE-V и скачайте шаблон параметров App-V из коллекции шаблонов UE-V, ознакомьтесь с приведенными ниже инструкциями.</p></li>
<li><p>Настройка режима общего доступа к хранилищу контента (SCS). Дополнительные сведения можно найти в разделе <a href="how-to-install-the-app-v-50-client-for-shared-content-store-mode.md" data-raw-source="[How to Install the App-V 5.0 Client for Shared Content Store Mode](how-to-install-the-app-v-50-client-for-shared-content-store-mode.md)"> Установка клиента App-V 5,0 для общего режима хранения содержимого </a> .</p></li>
<li><p>Настройка сохранения интеграции пользователей в реестре для входа в систему с параметром DWORD.</p></li>
<li><p>Предварительно настройте все пользовательские и глобальные целевые пакеты, например <strong> Add-AppvClientPackage </strong> .</p></li>
<li><p>Предварительная настройка всех групп пользователей и глобальных целевых подключений, например <strong> Add-AppvClientConnectionGroup </strong> .</p></li>
<li><p>Предварительно публикуйте все глобальные целевые пакеты.</p>
<p></p>
<p>Административ</p>
<ul>
<li><p>Выполнить глобальную публикацию или обновить.</p></li>
<li><p>Выполнение публикации или обновления пользователем.</p></li>
<li><p>Отмените публикацию всех пакетов, предназначенных для пользователей.</p></li>
<li><p>Удалите записи, указанные ниже пользователем (VFS) виртуальной файловой системы (DNS).</p></li>
</ul>
<p><code>AppData\Local\Microsoft\AppV\Client\VFS</code></p>
<p><code>AppData\Roaming\Microsoft\AppV\Client\VFS</code></p></li>
</ul></td>
<td align="left"><p></p>
<ul>
<li><p>Установите пакет исправлений 4 (SP4) для клиента Application Virtualization 5,0 версии клиента.</p></li>
<li><p>Установите UE-V и скачайте шаблон параметров App-V из коллекции шаблонов UE-V, ознакомьтесь с приведенными ниже инструкциями.</p></li>
<li><p>Настройка режима общего доступа к хранилищу контента (SCS). Дополнительные сведения можно найти в разделе <a href="how-to-install-the-app-v-50-client-for-shared-content-store-mode.md" data-raw-source="[How to Install the App-V 5.0 Client for Shared Content Store Mode](how-to-install-the-app-v-50-client-for-shared-content-store-mode.md)"> Установка клиента App-V 5,0 для общего режима хранения содержимого </a> .</p></li>
<li><p>Настройка сохранения интеграции пользователей в реестре для входа в систему с параметром DWORD.</p></li>
<li><p>Предварительно настройте все глобальные целевые пакеты, например <strong> Add-AppvClientPackage </strong> .</p></li>
<li><p>Предварительная настройка всех глобальных целевых групп подключений например, <strong> Add-AppvClientConnectionGroup </strong> .</p></li>
<li><p>Предварительно публикуйте все глобальные целевые пакеты.</p>
<p></p></li>
</ul></td>
</tr>
</tbody>
</table>



**Конфигурации** — для критически важных конфигураций клиента App-V и более подробного контекста и инструкции ознакомьтесь с приведенными ниже сведениями.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Параметр конфигурации</th>
<th align="left">Что это такое?</th>
<th align="left">Как его использовать?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Режим общего хранилища содержимого (SCS)</p>
<ul>
<li><p>Можно настроить в PowerShell с помощью <strong> Set-AppvClientConfiguration </strong> – <strong> SharedContentStoreMode </strong> или</p></li>
<li><p>Во время установки клиента App-V 5,0.</p></li>
</ul></td>
<td align="left"><p>При запуске общего хранилища содержимого только публикуемые данные сохраняются на жестком диске. другие виртуальные ресурсы приложения поддерживаются в памяти (RAM).</p>
<p>Это позволяет экономить локальное хранилище и минимизировать количество дисковых операций ввода-вывода в секунду (I/O).</p></td>
<td align="left"><p>Рекомендуется использовать это подключение при наличии подключений с малой задержкой между конечной точкой клиента App-V и сервером содержимого SCS, SAN.</p></td>
</tr>
<tr class="even">
<td align="left"><p>PreserveUserIntegrationsOnLogin</p>
<ul>
<li><p>Настройте в реестре в разделе <strong> HKEY_LOCAL_MACHINE </strong>  \  <strong> Программная </strong>  \  <strong> </strong>  \  <strong> интеграция Microsoft AppV </strong>  \  <strong> Client </strong>  \  <strong> Integration </strong> .</p></li>
<li><p>Создайте значение DWORD <strong> PreserveUserIntegrationsOnLogin </strong> со значением <strong> 1 </strong> .</p></li>
<li><p>Перезапустите клиентскую службу App-V или перезагрузите компьютер, на котором запущен клиент App-V.</p></li>
</ul></td>
<td align="left"><p>Если вы не настроили ( <strong> Add-AppvClientPackage </strong> ) конкретный пакет и этот параметр не настроен, клиент App-V будет разинтегрироваться * с сохраненной интеграцией пользователей, а затем снова интегрироваться в *.</p>
<p>Для каждого пакета, удовлетворяющего описанным выше условиям, два раза в ходе публикации и обновления будут выполнять эти действия.</p></td>
<td align="left"><p>Если вы не планируете предварительно настроить все доступные пользовательские пакеты в базовом образе, используйте этот параметр.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>MaxConcurrentPublishingRefresh</p>
<ul>
<li><p>Настройте в реестре в разделе <strong> HKEY_LOCAL_MACHINE </strong> &lt; надежная &gt; </strong>  \  <strong> </strong>  \  <strong> </strong> &lt; Публикация клиента Microsoft AppV strong &gt; </strong>  \  <strong> </strong> .</p></li>
<li><p>Создайте значение DWORD <strong> MaxConcurrentPublishingrefresh </strong> с требуемым максимальным количеством параллельных обновлений публикации.</p></li>
<li><p>Не требуется перезапускать клиентскую службу App-V и компьютер.</p></li>
</ul></td>
<td align="left"><p>Этот параметр определяет количество пользователей, которые могут одновременно выполнять обновление публикации или синхронизацию. Для параметра по умолчанию не задано ограничение.</p></td>
<td align="left"><p>Ограничение числа одновременных обновлений публикации предотвращает чрезмерное использование ЦП, что может повлиять на производительность компьютера. Это ограничение рекомендовано в среде RDS, где несколько пользователей могут одновременно войти на один компьютер и выполнить синхронизацию для обновления публикации.</p>
<p>Если пороговое значение обновления параллельных публикаций достигнуто, время, необходимое для публикации новых приложений и получения доступа к ним для конечных пользователей, может занять неопределенное время.</p></td>
</tr>
</tbody>
</table>



### Настройка решения UE-V для подхода App-V

Мы рекомендуем использовать Microsoft User Experience Virtualization (UE-V) для сбора и централизации параметров приложения и операционной системы Windows для определенного пользователя. Затем эти параметры применяются к разным компьютерам, к которым пользователь обращается, включая настольные компьютеры, Ноутбуки и сеансы инфраструктуры виртуальных рабочих столов (VDI). UE-V оптимизирован для сценариев RDS и VDI.

Дополнительные сведения содержатся [в разделе Приступая к работе с виртуализацией взаимодействия с пользователем 2,0](https://technet.microsoft.com/library/dn458936.aspx)

По сути, все, что нужно, — это установить клиент UE-V и загрузить следующий шаблон параметров Microsoft authored App-v из [коллекции шаблонов Microsoft User Experience Virtualization (UE-v)](https://gallery.technet.microsoft.com/Authored-UE-V-Settings-bb442a33). Зарегистрируйте шаблон. Дополнительные сведения о шаблонах UE-V см. [в разделе ресурс, специфический для UE-v, для приобретения и регистрации шаблона](https://technet.microsoft.com/library/dn458936.aspx).

**Примечание.**  
Не выполняя дополнительные этапы настройки, Виртуализация среды пользователя Майкрософт (UE-V) не сможет синхронизировать ярлыки меню "Пуск" (lnk) на целевом компьютере. Тип файлов. lnk исключен по умолчанию.

UE-V поддерживает удаление файлов с расширением. lnk из списка исключений в сценариях RDS и VDI, где на каждом устройстве пользователя будет находиться один и тот же набор приложений, но каждый из файлов. lnk подходит для всех устройств пользователей. Например, UE-V в настоящее время не поддерживает следующие 2 сценария, так как в этом случае вы увидите, что ярлык будет действителен на одном, но не на всех устройствах.

-   Если у пользователя установлено приложение на одном устройстве с разделом LNK-файлы и оно установлено на другом устройстве в другой корневой каталог установки с поддержкой файлов. lnk.

-   Если у пользователя установлено приложение на одном устройстве, но не другое, для которого включена поддержка LNK-файлов.



**Важно.**  
В этой статье описано, как изменить реестр Windows с помощью редактора реестра. Если изменить реестр Windows некорректно, это может привести к серьезным неполадкам, которые могут потребовать повторной установки Windows. Перед изменением реестра необходимо создать резервную копию файлов реестра (System. dat и User. dat). Корпорация Майкрософт не несет ответственности за то, что проблемы, которые могут возникнуть при изменении реестра, могут быть устранены. Изменение реестра на свой страх и риск.



С помощью редактора реестра Microsoft (regedit.exe) перейдите к разделу **hKey \ _LOCAL \ _MACHINE**  \\  **Программная**  \\  **Microsoft**  \\  **UEV**  \\  **Конфигурация агента**Microsoft UEV  \\  **Configuration**  \\  **ExcludedFileTypes** и удалите **. lnk** из исключенных типов файлов.

**Настройка другого решения для управления профилями пользователей (UPM) для подхода App-V**

Предполагается, что в среде с сохранением состояния ожидается, что решение UPM реализовано и может поддерживать сохранение пользовательских данных во время сеансов и между входами.

Требования для решения UPM описаны ниже.

Чтобы включить оптимизированное взаимодействие с входом, например приложение App-V 5,0 для пользователя, решение должно иметь возможность:

-   Сохранение описанных ниже интеграционных компонентов в рамках профиля пользователя или персонажа.

-   Запуск синхронизации профилей пользователей при входе (или запуске приложения), что может гарантировать, что все интеграции пользователей будут применены перед публикацией или обновлением.

-   Присоединение и отсоединение диска профиля пользователя (UPD) или аналогичной технологии, которая включает в себя интеграцию пользователей.

-   Регистрация изменений в расположениях, которые составляют интеграцию пользователей перед выходом из сеанса.

С помощью App-V 5,0 при добавлении сервера публикаций (**Add-AppvPublishingServer**) можно настроить синхронизацию, например обновить при входе в систему и (или) после указанного интервала обновления. В обоих случаях создается запланированная задача.

В предыдущих версиях App-V 5,0 обе запланированные задачи были настроены с использованием сценария VBScript, который инициировал пользователю и глобальному обновлению. В пакете исправлений 4 для Application Virtualization 5,0 с пакетом обновления 2 (SP2) обновление пользователей при входе инициируется **SyncAppvPublishingServer.exe**. Это изменение было введено для предоставления UPM решений в процессе запуска триггера. Этот процесс задерживает/Refresh публикации, чтобы позволить решению UPM применять интеграции пользователей. После завершения публикации или обновления приложение завершит работу.

**Интеграция пользователей**

Реестр — HKEY \ _CURRENT \ _USER

-   Path — Software\\Classes

    Исключить: локальные параметры, ActivatableClasses, AppX \ *

-   Path — Software\\Microsoft\\AppV

-   Пути — путь к Software\\Microsoft\\Windows\\CurrentVersion\\App

**Расположение файлов**

-   Root — "переменная среды" APPDATA

    Path — Microsoft\\AppV\\Client\\Catalog

-   Root — "переменная среды" APPDATA

    Path — Microsoft\\AppV\\Client\\Integration

-   Root — "переменная среды" APPDATA

    Path — Microsoft\\Windows\\Start Menu\\Programs

-   (Для сохранения всех ярлыков на рабочем столе, виртуальных и не виртуальных)

    Root-"KnownFolder" {B4BFCC3A-DB2C-424C-B029-7FE99A87C641} FileMask-\ *. lnk

**Microsoft User Experience Virtualization (UE-V)**

Кроме того, мы рекомендуем использовать Microsoft User Experience Virtualization (UE-V) для сбора и централизации параметров приложения и операционной системы Windows для определенного пользователя. Затем эти параметры применяются к разным компьютерам, к которым пользователь обращается, включая настольные компьютеры, Ноутбуки и сеансы инфраструктуры виртуальных рабочих столов (VDI).

Дополнительные сведения приведены в разделе [Начало работы с интерфейсом виртуализации пользователей 1,0](https://technet.microsoft.com/library/jj680015.aspx) и [общим расположением параметров с помощью галереи шаблонов UE-V](https://technet.microsoft.com/library/jj679972.aspx).

### <a href="" id="bkmk-uewt"></a>Руководство по работе с пользователем

Ниже приведены пошаговые инструкции по выполнению операций App-V и UPM, а также ожидаемые пользователи.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Оптимизировано для повышения производительности</th>
<th align="left">Оптимизировано для хранения</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>После реализации этого подхода в среде VDI или узлов сеансов удаленных рабочих столов при первом входе</p>
<ul>
<li><p>Функционировани Инициируется публикация или обновление пользователем. Быстроте Если пользователь в первый раз опубликовал виртуальные приложения (например, не являющиеся постоянными), это займет обычное время публикации или обновления.</p></li>
<li><p>Функционировани После публикации/обновления решение UPM перехватывает пользовательские интеграции. Быстроте В зависимости от того, как настроено решение UPM, это может возникнуть в процессе выхода из системы. Это приведет к тому же или похожему расходу, как и при сохранении состояния пользователя.</p></li>
</ul>
<p>При последующих входах:</p>
<ul>
<li><p>Функционировани Решение UPM применяет к системе пользовательские интеграции перед публикацией и обновлением.</p>
<p>Быстроте На рабочем столе есть ярлыки или в меню "Пуск", которое будет работать немедленно. После завершения публикации/обновления (например, изменения в пакетных ресурсах) некоторые из них могут исчезнуть.</p></li>
<li><p>Функционировани Публикация и обновление обрабатывают операции отмены публикации и публикации для изменений в целях обеспечения обслуживания пользовательских пакетов. Быстроте Если вы не намерены никаких изменений в отношении обслуживания, publishing1 закончится за считанные секунды. В противном случае публикация/обновление будут увеличиваться относительно числа и сложности * виртуальных приложений.</p></li>
<li><p>Функционировани Решение UPM повторно захватывает пользовательские интеграции при выходе из системы. Быстроте То же, что и в предыдущем.</p></li>
</ul>
<p>¹ операция публикации ( <strong> Publish-AppVClientPackage </strong> ) добавляет записи в каталог пользователей, сопоставляет данные с пользователем, определяет локальное хранилище и завершает работу, выполняя все этапы интеграции.</p></td>
<td align="left"><p>После реализации этого подхода в среде VDI или узлов сеансов удаленных рабочих столов при первом входе</p>
<ul>
<li><p>Функционировани Инициируется публикация или обновление пользователем. Быстроте</p>
<ul>
<li><p>Если пользователь в первый раз опубликовал виртуальные приложения (например, не являющиеся постоянными), это займет обычное время публикации или обновления.</p></li>
<li><p>Первый и следующий входные имена будут затронуты предварительно настроенными пакетами (Добавить/обновить).</p>
<p></p></li>
</ul></li>
<li><p>Функционировани После публикации/обновления решение UPM перехватывает пользовательские интеграции. Быстроте В зависимости от того, как настроено решение UPM, это может возникнуть в процессе выхода из системы. Это приведет к тому же или похожему расходу, как и при сохранении состояния пользователя</p></li>
</ul>
<p>При последующих входах:</p>
<ul>
<li><p>Функционировани Решение UPM применяет к системе пользовательские интеграции перед публикацией и обновлением.</p></li>
<li><p>Функционировани Для добавления и обновления необходимо предварительно настроить все целевые приложения пользователей. Быстроте</p>
<ul>
<li><p>Это может значительно увеличивать время доступности приложения (в порядке 10 секунд).</p></li>
<li><p>Это увеличит время обновления публикации относительно числа и сложности * виртуальных приложений.</p>
<p></p></li>
</ul></li>
<li><p>Функционировани Публикация и обновление обрабатывают операции отмены публикации и публикации для изменения прав на пользовательские пакеты.</p></li>
</ul></td>
</tr>
</tbody>
</table>



<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Результате</th>
<th align="left">Результате</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p></p>
<ul>
<li><p>Так как интеграция пользователей полностью сохраняется, не будет работать, например, интеграция публикации/обновления для завершения. Все виртуальные приложения будут доступны в течение секунд при входе.</p></li>
<li><p>Публикация и обновление обрабатывают изменения пользователей, которые имеют право на работу с виртуальными приложениями, которые влияют на взаимодействие.</p></li>
</ul></td>
<td align="left"><p>Так как добавление и обновление должны заново настроить все виртуальные приложения для виртуальной машины, будет расширено время обновления публикации при каждом входе.</p></td>
</tr>
</tbody>
</table>



### <a href="" id="bkmk-plc"></a>Влияние на жизненный цикл пакета

Обновление пакета является важнейшим аспектом жизненного цикла пакета. Чтобы гарантировать, что пользователи смогут получить доступ к соответствующим обновленным (опубликованным) пакетам виртуальных приложений, рекомендуется обновить базовое изображение, чтобы отразить эти изменения. Чтобы понять, Зачем просматривать следующий раздел:

Приложение App-V 5,0 SP2 представил концепцию состояний "ожидание". В прошлом

-   Если администратор изменил полномочия или создал новую версию пакета (обновлена), а также во время публикации или обновления этого пакета, то при выполнении операции отмены публикации или публикации, соответственно, произойдет сбой.

-   Теперь, если пакет используется, операция будет отложена. Операции отмены публикации и публикации-отгрузки будут обрабатываться при перезапуске службы или при выполнении другой команды публикации или отмены публикации. В последнем случае, если виртуальное приложение используется в противном случае, виртуальное приложение останется в состоянии ожидания. Для глобально опубликованных пакетов часто требуется перезагрузка (или перезапуск службы).

Маловероятно, что в непостоянной среде эти отложенные операции будут обрабатываться. Отложенные операции, например задачи, регистрируются в разделе **hKey \ _CURRENT \ _USER**  \\  **программного обеспечения**  \\  **клиента Microsoft**  \\  **AppV**  \\  **Client**  \\  **PendingTasks**. Несмотря на то, что это расположение сохраняется решением UPM, если оно не применяется к среде перед входом в систему, оно не будет обработано.

### <a href="" id="bkmk-evdi"></a>Улучшение возможностей VDI с помощью настройки оптимизации производительности

В следующем разделе содержатся списки, содержащие сведения о документации и загружаемых файлах, которые могут быть полезны при оптимизации среды для повышения производительности.

**Блог и сценарий NGEN .NET (настоятельно рекомендуется)**

О технологии NGEN

-   [Ускорение оптимизации NGEN](https://blogs.msdn.com/b/dotnet/archive/2013/08/06/wondering-why-mscorsvw-exe-has-high-cpu-usage-you-can-speed-it-up.aspx)

-   [Сценарий](https://aka.ms/DrainNGenQueue)

**Сервер и роли сервера Windows**

Рекомендации по настройке производительности сервера для

-   [Microsoft Windows Server 2012 R2](https://msdn.microsoft.com/library/windows/hardware/dn529133.aspx)

-   [Microsoft Windows Server 2012](https://download.microsoft.com/download/0/0/B/00BE76AF-D340-4759-8ECD-C80BC53B6231/performance-tuning-guidelines-windows-server-2012.docx)

-   [Microsoft Windows Server 2008 R2](https://download.microsoft.com/download/6/B/2/6B2EBD3A-302E-4553-AC00-9885BBF31E21/Perf-tun-srv-R2.docx)

**Роли сервера**

-   [Узел виртуализации удаленных рабочих столов](https://msdn.microsoft.com/library/windows/hardware/dn567643.aspx)

-   [Узел сеансов удаленных рабочих столов](https://msdn.microsoft.com/library/windows/hardware/dn567648.aspx)

-   [Релевантность для IIS: управление App-V, публикация, веб-службы отчетов](https://msdn.microsoft.com/library/windows/hardware/dn567678.aspx)

-   [Релевантность файлового сервера (SMB): Если используется для хранения содержимого App-V и доставки в режиме SCS](https://technet.microsoft.com/library/jj134210.aspx)

**Руководство по настройке производительности клиента Windows (гостевой ОС)**

-   [Microsoft Windows 7](https://download.microsoft.com/download/E/5/7/E5783D68-160B-4366-8387-114FC3E45EB4/Performance Tuning Guidelines for Windows 7 Desktop Virtualization v1.9.docx)

-   [Сценарий оптимизации: (предоставлено службой поддержки Майкрософт)](https://blogs.technet.com/b/jeff_stokes/archive/2012/10/15/the-microsoft-premier-field-engineer-pfe-view-on-virtual-desktop-vdi-density.aspx)

-   [Microsoft Windows 8](https://download.microsoft.com/download/6/0/1/601D7797-A063-4FA7-A2E5-74519B57C2B4/Windows_8_VDI_Image_Client_Tuning_Guide.pdf)

-   [Сценарий оптимизации: (предоставлено службой поддержки Майкрософт)](https://blogs.technet.com/b/jeff_stokes/archive/2013/04/09/hot-off-the-presses-get-it-now-the-windows-8-vdi-optimization-script-courtesy-of-pfe.aspx)

## Последовательность действий по оптимизации пакетов для повышения производительности публикации


App-V 5,0 и App-V 5,0 SP2 предоставляют значительные значения в соответствующих выпусках. Некоторые функции упрощают новые сценарии или включены новые сценарии развертывания клиентов. Следующие функции могут повлиять на производительность операций публикации и запуска.

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Шаг</th>
<th align="left">Параметр</th>
<th align="left">Преимущества</th>
<th align="left">Необходимости компромиссов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Отсутствует блок компонентов 1 (FB1, также называемый основным FB)</p></td>
<td align="left"><p>Нет FB1 означает, что приложение будет запущено немедленно и не попадет сообщение об ошибке потока (для работы приложения требуется файл, DLL и он должен переключаться по сети) во время запуска. Если у вас есть ограничения сети, FB1 будет:</p>
<ul>
<li><p>Уменьшите количество сбоев потоков и пропускную способность сети, используемую при запуске приложения в первый раз.</p></li>
<li><p>Задерживает запуск, пока не будет переFB1ся весь поток.</p></li>
</ul></td>
<td align="left"><p>Сбой потока уменьшает время запуска.</p></td>
<td align="left"><p>Пакеты виртуальных приложений, для которых настроен FB1, должны быть повторно упорядочены.</p></td>
</tr>
</tbody>
</table>



### Удаление FB1

Для удаления FB1 не требуется исходный установщик приложения. После выполнения описанных ниже действий рекомендуется вернуть компьютер, на котором запущен секвенсор, в пустой снимок.

**Интерфейс Sequencer** — создание нового пакета виртуальных приложений.

1.  Завершите этапы последовательности, чтобы настроить &gt; потоковую передачу.

2.  При потоковой передаче не выбирайте параметр **оптимизировать пакет для развертывания в медленной или ненадежной сети**.

3.  При необходимости перейдите на **целевую операционную систему**.

**Изменение существующего пакета виртуальных приложений**

1.  Завершите этапы последовательности, чтобы переписать поток.

2.  Не выбирайте параметр **оптимизировать пакет для развертывания в медленной или ненадежной сети**.

3.  Переместить, чтобы **создать пакет**.

**PowerShell** — обновите существующий виртуальный пакет приложения.

1.  Откройте сеанс PowerShell с повышенными привилегиями.

2.  Import-Module **appvsequencer**.

3.  **Update-AppvSequencerPackage**  -  **AppvPackageFilePath**

    "C:\\Packages\\MyPackage.appv" — установщик

    "C:\\PackageInstall\\PackageUpgrade.exe empty.exe"-OutputPath

    "C:\\UpgradedPackages"

    **Примечание.**  
    Для этого командлета требуется исполняемый (exe) или пакетный файл (bat). Необходимо предоставить пустой (не имеющий ничего) исполняемый или пакетный файл.



<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Шаг</th>
<th align="left">Довод</th>
<th align="left">Преимущества</th>
<th align="left">Необходимости компромиссов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Без установки SXS на этапе публикации (предварительно устанавливаемые сборки SxS)</p></td>
<td align="left"><p>Виртуальные пакеты приложений не нуждаются в повторной последовательности. Сборки SxS могут оставаться в виртуальном пакете приложений.</p></td>
<td align="left"><p>Зависимости сборок SxS не будут устанавливаться во время публикации.</p></td>
<td align="left"><p>Зависимости сборок SxS должны быть предварительно установлены.</p></td>
</tr>
</tbody>
</table>



### Создание нового пакета виртуальных приложений в секвенсоре

Если во время наблюдения Sequencer сборка SxS (например, среда выполнения VC + +) устанавливается как часть установки приложения, сборка SxS будет автоматически обнаружена и включена в пакет. Администратор будет уведомлен и будет иметь возможность исключить сборку SxS.

На **стороне клиента**:

При публикации пакета виртуальных приложений клиент App-V 5,0 с пакетом обновления 2 (SP2) обнаружит, была ли уже установлена нужная зависимость SxS. Если зависимость недоступна на компьютере и включена в пакет, это традиционный установщик Windows (.** MSI**) будет инициирована установка сборки SxS. Как описано выше, установите зависимость на компьютере, на котором запущен клиент, чтобы убедиться, что установка установщика Windows (MSI) не будет выполняться.

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Шаг</th>
<th align="left">Довод</th>
<th align="left">Преимущества</th>
<th align="left">Необходимости компромиссов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Выборочно использовать динамические файлы конфигурации</p></td>
<td align="left"><p>Клиент App-V 5,0 должен проанализировать и обработать эти динамические файлы конфигурации.</p>
<p>Следует понимать размер и сложность (выполнение сценария, включение и исключение VREG) файла.</p>
<p>В многочисленных виртуальных пакетах приложений может быть уже есть файлы динамических конфигураций, определенные пользователем или компьютером.</p></td>
<td align="left"><p>Во всех случаях, когда эти файлы используются выборочно или вообще не поддерживаются, будет улучшено количество публикаций.</p></td>
<td align="left"><p>Для удаления связанных динамических файлов конфигурации необходимо настроить виртуальные пакеты приложений по отдельности или с помощью консоли управления сервером App-V.</p></td>
</tr>
</tbody>
</table>



### Отключение динамической конфигурации с помощью PowerShell

-   Если вы уже опубликовали пакеты, вы можете использовать его `Set-AppVClientPackage –Name Myapp –Path c:\Packages\Apps\MyApp.appv` без

    Параметр **-DynamicDeploymentConfiguration**

-   Аналогичным образом, при добавлении новых пакетов с помощью `Add-AppVClientPackage –Path c:\Packages\Apps\MyApp.appv` , не используйте

    Параметр **-DynamicDeploymentConfiguration** .

Документацию по применению динамической конфигурации можно найти в следующих случаях:

-   [Применение файла конфигурации пользователя с помощью PowerShell](how-to-apply-the-user-configuration-file-by-using-powershell.md)

-   [Применение файла конфигурации развертывания с помощью PowerShell](how-to-apply-the-deployment-configuration-file-by-using-powershell.md)

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Шаг</th>
<th align="left">Довод</th>
<th align="left">Преимущества</th>
<th align="left">Необходимости компромиссов</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Учетная запись для выполнения синхронного сценария в течение жизненного цикла пакета.</p></td>
<td align="left"><p>Если в пакет внедрена сопутствующие сценарии, то добавить (PowerShell) может быть значительно медленнее.</p>
<p>Выполнение сценариев во время запуска виртуальных приложений (StartVirtualEnvironment, StartProcess) и/или добавления + публикации может повлиять на воспринимаемую производительность во время одной или нескольких из этих операций жизненного цикла.</p></td>
<td align="left"><p>Использование асинхронных сценариев (без блокировки) гарантирует эффективное выполнение операций жизненного цикла.</p></td>
<td align="left"><p>На этом этапе требуется получить сведения о всех виртуальных пакетах приложений со встроенными материалами, связанными с динамическими настройками, а затем ссылаться и выполнять сценарии синхронно.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Удалите из пакета внешние виртуальные шрифты.</p></td>
<td align="left"><p>Большинство приложений, изучающих группу разработчиков App-V, содержало небольшое количество шрифтов, обычно менее 20.</p></td>
<td align="left"><p>Виртуальные шрифты влияют на производительность обновления публикации.</p></td>
<td align="left"><p>Нужные шрифты должны быть включены и установлены в исходном виде. Инструкции можно найти в разделе Установка и удаление шрифтов.</p></td>
</tr>
</tbody>
</table>



### Определение того, какие виртуальные шрифты есть в пакете

-   Сделайте копию пакета.

-   Переименование пакета \ _copy. AppV в Package\_copy.zip

-   Откройте AppxManifest.xml и найдите следующее:

    &lt;AppV: Extension Category = "AppV. шрифты"&gt;

    &lt;AppV: шрифты&gt;

    &lt;AppV: font Path = "\ [{шрифты} \] \\private\\CalibriL.ttf" DelayLoad = "истина" &gt; &lt; /AppV: font&gt;

    **Примечание.**  
    Если у вас есть шрифты, помеченные как **DelayLoad**, то они не повлияют на первый запуск.



~~~
&lt;/appv:Fonts&gt;
~~~

### Исключение виртуальных шрифтов из пакета

Используйте динамический файл конфигурации, который лучше всего подходит для области "область пользователя — Конфигурация развертывания" для всех пользователей на компьютере, Конфигурация пользователя для определенного пользователя или пользователей.

-   Отключите шрифты с помощью развертывания или конфигурации пользователя.

Шрифты

--&gt;

&lt;Шрифты разрешены = "ложь"/&gt;

&lt;!--

## <a href="" id="bkmk-terms1"></a> Терминология руководства по производительности App-V 5,0


Следующие термины используются для описания концепций и действий, связанных с оптимизацией производительности App-V 5,0.

-   **Сложность** — относится к одной или нескольким характеристикам пакета, которые могут повлиять на производительность при предварительной настройке (**Add-AppvClientPackage**) или интеграции (**Publish-AppvClientPackage**). Ниже приведены некоторые примеры характеристик: Размер манифеста, количество виртуальных шрифтов, количество файлов.

-   **De-интеграция** — удаляет пользовательские интеграции.

-   После **повторной интеграции** применяются пользовательские интеграции.

-   **Непостоянные, в** составе пула — создает компьютер под управлением виртуальной среды при каждом входе.

-   **Постоянный, персональный** — компьютер под управлением виртуальной среды, который остается одинаковым для каждой учетной записи.

-   С **сохранением состояния** для этого документа означает, что интеграция пользователей сохраняется между сеансами, а технология управления средой пользователя используется совместно с несохраняемыми или одновременными сеансовми удаленных рабочих столов или VDI.

-   Без **сведений о состоянии** — представляет сценарий, если состояние пользователя не сохраняется между сеансами.

-   **Триггер** – (или триггеры собственных действий). UPM использует эти типы триггеров для запуска наблюдения или операций синхронизации.

-   **Взаимодействие с пользователем** : в контексте App-V 5,0, пользовательским интерфейсом является сумма следующих частей.

    -   С той точки, на которую пользователи начинают вход, когда они смогут управлять рабочим столом.

    -   С точки зрения того, на котором можно взаимодействовать с рабочим столом в точке, начиная с которой начинается обновление публикации (в терминах PowerShell, синхронизация) при использовании полной серверной инфраструктуры App-V 5,0. В отдельных экземплярах инициировано создание команд PowerShell **Add-AppVClientPackage** и **Publish-AppVClientPackage** .

    -   От начала до завершения обновления публикации. В автономных экземплярах это первое и последнее опубликованное виртуальное приложение.

    -   С того места, где виртуальное приложение доступно для запуска из ярлыка. Кроме того, это происходит с того места, в котором зарегистрирована Ассоциация типа файла, и запустится указанное виртуальное приложение.

-   **Управление профилями пользователей** — управляемый и структурированный подход к управлению пользовательскими компонентами, связанными с этой средой. Например, профили пользователей, настройки и управление политиками, элементы управления приложениями и развертывание приложений. Вы можете использовать сценарии или решения сторонних разработчиков для настройки среды по мере необходимости.






## Статьи по теме


[Руководство администратора Microsoft Application Virtualization 5,0](microsoft-application-virtualization-50-administrators-guide.md)









