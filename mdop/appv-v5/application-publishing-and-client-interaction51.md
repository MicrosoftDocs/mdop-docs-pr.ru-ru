---
title: Публикация приложений и взаимодействие с клиентом
description: Публикация приложений и взаимодействие с клиентом
author: dansimp
ms.assetid: 36a4bf6f-a917-41a6-9856-6248686df352
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, appcompat, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 08/30/2016
ms.openlocfilehash: 69fcf119faaf35e53ae36f386bcb3480e2ee3b0e
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/26/2020
ms.locfileid: "10814733"
---
# Публикация приложений и взаимодействие с клиентом


В этой статье приводятся технические сведения об общих операциях клиента App-V и их интеграции с локальной операционной системой.

-   [Файлы пакета App-V, созданные секвенсором](#bkmk-appv-pkg-files-list)

-   [Что находится в файле AppV?](#bkmk-appv-file-contents)

-   [Места хранения данных клиента App-V](#bkmk-files-data-storage)

-   [Реестр пакета](#bkmk-pkg-registry)

-   [Поведение хранилища пакетов App-V](#bkmk-pkg-store-behavior)

-   [Перемещаемый реестр и данные](#bkmk-roaming-reg-data)

-   [Управление жизненным циклом в клиентском приложении App-V](#bkmk-clt-app-lifecycle)

-   [Интеграция пакетов App-V](#bkmk-integr-appv-pkgs)

-   [Динамическая обработка конфигурации](#bkmk-dynamic-config)

-   [Параллельные сборки](#bkmk-sidebyside-assemblies)

-   [Ведение журнала на стороне клиента](#bkmk-client-logging)

Дополнительные сведения можно найти в разделе [ресурсы документации Microsoft Application Virtualization (App-V) download page](https://www.microsoft.com/download/details.aspx?id=27760).

## <a href="" id="bkmk-appv-pkg-files-list"></a>Файлы пакета App-V, созданные секвенсором


Секвенсор создает пакеты App-V и создает виртуализированное приложение. В процессе упорядочивания создаются следующие файлы:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Файл</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>. AppV</p></td>
<td align="left"><ul>
<li><p>Основной файл пакета, который включает собранные ресурсы и сведения о состоянии из процесса упорядочения.</p></li>
<li><p>Архитектура файла пакета, сведения о публикации и реестр в маркерной форме, которая может быть повторно применена к компьютеру и определенному пользователю при доставке.</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>. УСТАНОВЩИКА</p></td>
<td align="left"><p>Исполняемая обертка развертывания, которую можно использовать для развертывания AppV-файлов вручную или с помощью сторонней платформы развертывания.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>_DeploymentConfig.XML</p></td>
<td align="left"><p>Файл, который используется для настройки параметров публикации по умолчанию для всех приложений в пакете, который развертывается глобально для всех пользователей на компьютере, на котором запущен клиент App-V.</p></td>
</tr>
<tr class="even">
<td align="left"><p>_UserConfig.XML</p></td>
<td align="left"><p>Файл, который используется для настройки параметров публикации для всех приложений в пакете, развернутого для определенного пользователя на компьютере, на котором запущен клиент App-V.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Report.xml</p></td>
<td align="left"><p>Сводка сообщений, которые приводили к процессу последовательности, включая пропущенные драйверы, файлы и расположения в реестре.</p></td>
</tr>
<tr class="even">
<td align="left"><p>. ФОРМАТЕ</p></td>
<td align="left"><p><em>Необязательный: </em> файл ускорителя пакетов, используемый для автоматического перестроения ранее упорядоченного виртуального пакета приложения.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>.appvt</p></td>
<td align="left"><p><em>Необязательный: </em> файл шаблона Sequencer, используемый для хранения часто используемых параметров секвенсора.</p></td>
</tr>
</tbody>
</table>

 

Сведения о последовательностях можно найти в [руководстве упорядочение Application Virtualization](https://go.microsoft.com/fwlink/?LinkID=269810).

## <a href="" id="bkmk-appv-file-contents"></a>Что находится в файле AppV?


Файл AppV является контейнером, в котором хранятся XML-и неxml-файлы вместе в одной сущности. Этот файл строится на основе формата AppX, который основан на стандартах Open Packaging Conventions (OPC).

Чтобы просмотреть содержимое файла AppV, сделайте копию пакета, а затем переименуйте копируемый файл на расширение ZIP.

В файле AppV находятся следующие папки и файлы, которые используются при создании и публикации виртуального приложения.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Имя</th>
<th align="left">Тип</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Корень</p></td>
<td align="left"><p>Папка файла</p></td>
<td align="left"><p>Каталог, содержащий файловую систему для виртуализированного приложения, которое захватывается во время упорядочения.</p></td>
</tr>
<tr class="even">
<td align="left"><p>[Content_Types]. XML</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Список основных типов контента в AppV-файле (например, DLL, EXE, BIN).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AppxBlockMap.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Макет файла AppV, в котором используются элементы File, Block и BlockMap, которые обеспечивают расположение и проверку файлов в пакете App-V.</p></td>
</tr>
<tr class="even">
<td align="left"><p>AppxManifest.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Метаданные для пакета, которые содержат необходимые сведения для добавления, публикации и запуска пакета. Включает точки расширения (сопоставления и сочетания для типов файлов), а также имена и GUID, связанные с пакетом.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>FilesystemMetadata.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Список файлов, собранных в ходе последовательности, включая атрибуты (например, каталоги, файлы, непрозрачные каталоги, пустые каталоги и длинные и короткие имена).</p></td>
</tr>
<tr class="even">
<td align="left"><p>PackageHistory.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Сведения о компьютере виртуализации (версия операционной системы, версия Internet Explorer, версия .NET Framework) и процесс (обновление, версия пакета).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Registry. dat</p></td>
<td align="left"><p>DAT файл</p></td>
<td align="left"><p>Разделы реестра и значения, захваченные во время процесса упорядочения для пакета.</p></td>
</tr>
<tr class="even">
<td align="left"><p>StreamMap.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Список файлов для основного и функционального блоков публикации. Функциональный блок публикации включает в себя ICO-файлы и необходимые части файлов (EXE и DLL) для публикации пакета. При наличии основного блока функций включает файлы, которые были оптимизированы для потоковой передачи в процессе упорядочивания.</p></td>
</tr>
</tbody>
</table>

 

## <a href="" id="bkmk-files-data-storage"></a>Места хранения данных клиента App-V


Клиент App-V выполняет задачи, чтобы убедиться, что виртуальные приложения работают должным образом и работают как локально установленные приложения. Для открытия и запуска виртуальных приложений требуется сопоставление в виртуальной файловой системе и реестре, чтобы убедиться, что приложение содержит необходимые компоненты традиционного приложения, ожидаемые пользователями. В этом разделе описаны ресурсы, необходимые для запуска виртуальных приложений, и перечислены расположения, в которых App-V хранит ресурсы.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Имя</th>
<th align="left">Расположение</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Хранилище пакетов</p></td>
<td align="left"><p>%ProgramData%\App-V</p></td>
<td align="left"><p>Расположение по умолчанию для файлов пакетов только для чтения</p></td>
</tr>
<tr class="even">
<td align="left"><p>Каталог компьютера</p></td>
<td align="left"><p>%ProgramData%\Microsoft\AppV\Client\Catalog</p></td>
<td align="left"><p>Содержимое документов конфигурации для компьютера</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Каталог пользователей</p></td>
<td align="left"><p>%AppData%\Microsoft\AppV\Client\Catalog</p></td>
<td align="left"><p>Содержат документы конфигурации для отдельных пользователей</p></td>
</tr>
<tr class="even">
<td align="left"><p>Резервные копии ярлыков</p></td>
<td align="left"><p>%AppData%\Microsoft\AppV\Client\Integration\ShortCutBackups</p></td>
<td align="left"><p>Хранит предыдущие точки интеграции, которые обеспечивают восстановление пакета в процессе отмены публикации.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Копирование при записи в роуминге (COW)</p></td>
<td align="left"><p>%AppData%\Microsoft\AppV\Client\VFS</p></td>
<td align="left"><p>Перемещаемое расположение для записи для изменения пакета</p></td>
</tr>
<tr class="even">
<td align="left"><p>Локальное копирование на запись (COW)</p></td>
<td align="left"><p>%LocalAppData%\Microsoft\AppV\Client\VFS</p></td>
<td align="left"><p>Расположение для записи, которое не является перемещаемым, для изменения пакета</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Реестр компьютера</p></td>
<td align="left"><p>HKLM\Software\Microsoft\AppV</p></td>
<td align="left"><p>Содержит сведения о состоянии пакета, включая VReg для компьютера или глобально опубликованных пакетов (куст машины).</p></td>
</tr>
<tr class="even">
<td align="left"><p>Реестр пользователя</p></td>
<td align="left"><p>HKCU\Software\Microsoft\AppV</p></td>
<td align="left"><p>Содержит сведения о состоянии пользовательского пакета, включая VReg</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Пользовательские классы реестра</p></td>
<td align="left"><p>HKCU\Software\Classes\AppV</p></td>
<td align="left"><p>Содержат дополнительные сведения о состоянии пользовательского пакета</p></td>
</tr>
</tbody>
</table>

 

Дополнительные сведения о таблице приведены в разделе ниже и на протяжении всего документа.

### Хранилище пакетов

Клиент App-V управляет активами приложений, смонтированными в магазине пакетов. Это место хранения по умолчанию `%ProgramData%\App-V` , но вы можете настроить его во время или после установки с помощью `Set-AppVClientConfiguration` команды PowerShell, которая изменяет локальный реестр ( `PackageInstallationRoot` параметр под `HKLM\Software\Microsoft\AppV\Client\Streaming` ключом). Хранилище пакетов должно находиться по локальному пути в клиентской операционной системе. Отдельные пакеты хранятся в хранилище пакетов в подкаталогах, названных для GUID пакета и GUID версии.

Пример пути к определенному приложению:

``` syntax
C:\ProgramData\App-V\PackGUID\VersionGUID
```

Чтобы изменить расположение хранилища пакетов по умолчанию во время установки, ознакомьтесь со [сведениями о том, как развернуть клиент App-V](how-to-deploy-the-app-v-client-51gb18030.md).

### Общее хранилище содержимого

Если клиент App-V настроен в режиме хранения общего содержимого, при возникновении ошибки в потоке данные не записываются на диск, что означает, что для пакетов требуется минимальный объем локального диска (данные публикации). В средах VDI очень желательно использовать меньше дискового пространства, где локальное хранилище может быть ограничено, и потоковая передача приложений из высокопроизводительного сетевого расположения (например, SAN) предпочтительнее. Дополнительные сведения о режиме общего хранилища содержимого можно найти в разделе <https://go.microsoft.com/fwlink/p/?LinkId=392750> .

**Примечание**  Компьютер и хранилище пакетов должны располагаться на локальном диске, даже если вы используете конфигурации общего хранилища контента для клиента App-V.

 

### Каталоги пакетов

Клиент App-V управляет следующими двумя разположениями на основе файлов:

-   **Каталоги (пользователи и компьютеры).**

-   **Расположения в реестре** — зависят от того, как предназначен для публикации пакет. Существует каталог (хранилище данных) для компьютера и каталог для каждого отдельного пользователя. Каталог Machine хранит общие сведения, применимые для всех пользователей или пользователей, а каталог пользователей хранит сведения, применимые для определенного пользователя. Каталог — это коллекция динамических конфигураций и файлов манифеста. для файлов и реестра в каждой версии пакета есть дискретные данные. 

### Каталог компьютера

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p>Описание</p></td>
<td align="left"><p>Хранит документы пакета, доступные пользователям компьютера, при добавлении и публикации пакетов. Тем не менее, если во время публикации пакет является глобальным, интеграция будет доступна всем пользователям.</p>
<p>Если пакет не является глобальным, они публикуются только для определенных пользователей, но глобальные ресурсы, которые были изменены и видны всем пользователям на клиентском компьютере (например, каталог пакета, находятся в общем расположении диска).</p>
<p>Если пакет доступен для пользователя на компьютере (Global или non Global), манифест сохраняется в каталоге компьютера. Если пакет опубликован глобально, существует динамический файл конфигурации, хранящийся в каталоге компьютера; Таким образом, определение того, является ли пакет глобальным, зависит от того, есть ли в каталоге компьютера файл политики (файл UserDeploymentConfiguration).</p></td>
</tr>
<tr class="even">
<td align="left"><p>Место хранения по умолчанию</p></td>
<td align="left"><p><code>%programdata%\Microsoft\AppV\Client\Catalog&lt;/code&gt;</p>
<p>Это расположение не совпадает с расположением хранилища пакетов. Хранилище пакетов является золотым или pristine копией файлов пакета.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Файлы в каталоге компьютера</p></td>
<td align="left"><ul>
<li><p>Manifest.xml</p></li>
<li><p>DeploymentConfiguration.xml</p></li>
<li><p>UserManifest.xml (глобально опубликованный пакет)</p></li>
<li><p>UserDeploymentConfiguration.xml (глобально опубликованный пакет)</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>Дополнительное расположение каталога компьютера, используемое, если пакет входит в группу подключения</p></td>
<td align="left"><p>Следующее расположение находится в дополнение к определенному расположению пакета, упомянутому выше.</p>
<p><code>%programdata%\Microsoft\AppV\Client\Catalog\PackageGroups\ConGroupGUID\ConGroupVerGUID</code></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Дополнительные файлы в каталоге компьютера, если пакет входит в группу подключения</p></td>
<td align="left"><ul>
<li><p>PackageGroupDescriptor.xml</p></li>
<li><p>UserPackageGroupDescriptor.xml (глобально опубликованная группа подключений)</p></li>
</ul></td>
</tr>
</tbody>
</table>

 

### Каталог пользователей

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p>Описание</p></td>
<td align="left"><p>Создан в процессе публикации. Содержит сведения, используемые для публикации пакета и используемые при запуске, чтобы убедиться, что пакет предоставлен определенному пользователю. Создан в перемещаемом расположении и включает сведения о публикации для определенного пользователя.</p>
<p>При публикации пакета для пользователя файл политики хранится в каталоге пользователей. В то же время копия манифеста также хранится в каталоге пользователей. При удалении пакета обслуживания для пользователя связанные файлы пакета удаляются из каталога пользователей. Просматривая каталог пользователей, администратор может просмотреть присутствие динамического файла конфигурации, указывающий на то, что пакет является уполномоченным для этого пользователя.</p>
<p>Для перемещаемых пользователей каталог пользователей должен находиться в роуминге или в общем расположении, чтобы сохранить поведение устаревшего поведения App-V для пользователей по умолчанию. Права на доступ к данным и политика связаны с пользователем, а не с компьютером, поэтому они должны перемещаться с пользователем после подготовки.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Место хранения по умолчанию</p></td>
<td align="left"><p><code>appdata\roaming\Microsoft\AppV\Client\Catalog\Packages\PkgGUID\VerGUID</code></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Файлы в каталоге пользователей</p></td>
<td align="left"><ul>
<li><p>UserManifest.xml</p></li>
<li><p>DynamicConfiguration.xml или UserDeploymentConfiguration.xml</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>Дополнительное расположение пользовательского каталога, используемое, если пакет входит в группу подключения</p></td>
<td align="left"><p>Следующее расположение находится в дополнение к определенному расположению пакета, упомянутому выше.</p>
<p><code>appdata\roaming\Microsoft\AppV\Client\Catalog\PackageGroups\PkgGroupGUID\PkgGroupVerGUID</code></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Дополнительный файл в каталоге компьютера, когда пакет входит в группу подключения</p></td>
<td align="left"><p><code>UserPackageGroupDescriptor.xml</code></p></td>
</tr>
</tbody>
</table>

 

### Резервные копии ярлыков

В процессе публикации клиент App-V копирует все сочетания клавиш и точки интеграции в `%AppData%\Microsoft\AppV\Client\Integration\ShortCutBackups.` эту резервную копию, что позволяет восстановить эти точки интеграции с более ранними версиями после отмены публикации пакета.

### Копирование при записи файлов

Хранилище пакетов содержит pristine копию файлов пакета, которые были упакованы на сервере публикации. Во время нормальной работы приложения App-V пользователь или служба могут потребовать изменения файлов. Эти изменения не вносятся в хранилище пакетов, чтобы сохранить возможность восстановления приложения, что приводит к удалению этих изменений. В этих расположениях, именуемом copy on write (COW), поддерживается как перемещаемые, так и неперемещаемые места. Расположение, в котором хранятся изменения, зависит от того, где приложение запрограммировано для внесения изменений в собственный интерфейс.

### COW роуминг

В указанном выше расположении для перемещения COW в файлах и каталогах, ориентированных на типичное расположение% AppData% или на \\Users\\{username}\\AppData\\Roaming, указаны изменения. Эти каталоги и файлы затем перемещаются в соответствии с параметрами операционной системы.

### Локальный COW

Локальное расположение COW похоже на расположение для перемещения, но каталоги и файлы не перемещаются на другие компьютеры, даже если настроена поддержка роуминга. Локальное расположение COW, описанное выше, сохраняет изменения, применимые к типичным окнам, а не к расположению% AppData%. Перечисленные каталоги будут различаться, но для некоторых типичных местоположений Windows (например, Общая папка AppData и распространенные папки AppData) будут отображаться два расположения. " **S** " указывает на расположение с ограничениями, когда виртуальная служба запрашивает изменение в качестве другого пользователя с повышенными правами от пользователей, которые вошли в систему. В расположении, отличном от**S** , сохраняются изменения, внесенные пользователем.

## <a href="" id="bkmk-pkg-registry"></a>Реестр пакета


Перед тем как приложение сможет получить доступ к данным реестра пакета, клиент App-V должен сделать данные реестра пакета доступными для приложений. Клиент App-V использует реальный реестр в качестве резервного хранилища для всех данных реестра.

При добавлении нового пакета в клиент App-V копия реестра. DAT — файл, на который вы создали пакет `%ProgramData%\Microsoft\AppV\Client\VREG\{Version GUID}.dat` . Именем файла является GUID версии с помощью. Расширение DAT. Причина, по которой вы сделали это, заключается в том, чтобы убедиться в том, что фактический файл куста в пакете не используется, что может привести к невозможности удаления пакета позже.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Registry. dat из хранилища пакетов</strong></p></td>
<td align="left"><p><strong> &gt; </strong></p></td>
<td align="left"><p><strong>%ProgramData%\Microsoft\AppV\Client\Vreg {VersionGuid}. dat</strong></p></td>
</tr>
</tbody>
</table>

 

Когда первое приложение из пакета запускается на клиентском компьютере, клиент помещает или копирует содержимое из файла куста, повторно создавая данные реестра пакета в другом расположении `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AppV\Client\Packages\PackageGuid\Versions\VersionGuid\REGISTRY` . У поэтапных данных в реестре есть два различных типа данных компьютера и данные пользователя. Данные компьютера будут общими для всех пользователей компьютера. Пользовательские данные помещаются для каждого пользователя в userspecific расположение `HKCU\Software\Microsoft\AppV\Client\Packages\PackageGuid\Registry\User` . Данные компьютера в конечном итоге удаляются во время удаления пакета, и данные пользователя удаляются при отмене публикации пользователем.

### Настройка промежуточного хранения и реестра для групп подключений

При наличии групп соединений предыдущий процесс размещения реестра имеет значение истина, но вместо одного файла куста для обработки существует больше одного. Файлы обрабатываются в том порядке, в котором они отображаются в XML-файле группы соединения, при этом первый модуль записи выигрывает любые конфликты.

Поэтапный реестр сохраняется так же, как и в одном корпусе пакета. Промежуточные данные пользовательского реестра остаются для группы подключения до тех пор, пока они не будут отключены; данные реестра для промежуточного компьютера удаляются при удалении группы подключения.

### Виртуальный реестр

Цель виртуального реестра (VREG) — предоставить единое объединенное представление реестра пакета и собственного реестра для приложений. Она также предоставляет функциональность копирования при записи (COW), что позволяет вносить любые изменения, внесенные в реестр из контекста виртуального процесса, в отдельном расположении COW. Это означает, что VREG должен объединять до трех отдельных расположений в одном представлении, основываясь на заполненных расположениях в реестре COW — &gt; &gt; native Package. При выполнении запроса для данных в реестре он будет расположен в нужном порядке, пока не обнаружит данные, которые они запросили. Это означает, что при наличии значения, хранящегося в COW расположении, оно не будет переходить к другим расположениям, но если в COW расположении отсутствуют данные, они будут переходить к пакету, а затем найдет собственное расположение, пока не обнаружит соответствующие данные.

### Расположения в реестре

Существует два расположения реестра Package и два расположения групп подключений, в которых клиент App-V хранит данные реестра в зависимости от того, публикуется ли пакет по отдельности или как часть группы подключения. Существуют три места COW для пакетов и 3 для групп подключения, которые создаются и управляются VREG. Параметры пакетов и групп подключений не являются общими.

**VReg одного пакета:**

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Расположение</strong></p></td>
<td align="left"><p><strong>Описание</strong></p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>COW</strong></p></td>
<td align="left"><ul>
<li><p>Компьютер Registry\Client\Packages\PkgGUID\REGISTRY (только процесс с повышенными привилегиями может написать)</p></li>
<li><p>User Registry\Client\Packages\PkgGUID\REGISTRY (пользователь, который в HKCU и на нем написаны все, кроме Software\Classes</p></li>
<li><p>Classes\Client\Packages\PkgGUID\REGISTRY реестра пользователя (HKCU\Software\Classes записи и HKLM для процесса без повышенных привилегий)</p></li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Пакет</strong></p></td>
<td align="left"><ul>
<li><p>Machine Registry\Client\Packages\PkgGUID\Versions\VerGuid\Registry\Machine</p></li>
<li><p>Classes\Client\Packages\PkgGUID\Versions\VerGUID\Registry реестра пользователя</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Разряд</strong></p></td>
<td align="left"><ul>
<li><p>Расположение реестра собственного приложения</p></li>
</ul></td>
</tr>
</tbody>
</table>

 

 

**VReg группы подключения:**

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Расположение</strong></p></td>
<td align="left"><p><strong>Описание</strong></p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>COW</strong></p></td>
<td align="left"><ul>
<li><p>Компьютер Registry\Client\PackageGroups\GrpGUID\REGISTRY (только процесс с повышенными привилегиями может написать)</p></li>
<li><p>User Registry\Client\PackageGroups\GrpGUID\REGISTRY (все, что написано в HKCU, за исключением Software\Classes</p></li>
<li><p>Classes\Client\PackageGroups\GrpGUID\REGISTRY реестра пользователя</p></li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Пакет</strong></p></td>
<td align="left"><ul>
<li><p>Machine Registry\Client\PackageGroups\GrpGUID\Versions\VerGUID\REGISTRY</p></li>
<li><p>Classes\Client\PackageGroups\GrpGUID\Versions\VerGUID\REGISTRY реестра пользователя</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Разряд</strong></p></td>
<td align="left"><ul>
<li><p>Расположение реестра собственного приложения</p></li>
</ul></td>
</tr>
</tbody>
</table>

 

 

Для HKLM существует два места COW; процессы с повышенными привилегиями и без повышенных привилегий. Процессы с повышенными правами всегда записывают изменения в HKLM в безопасном COW в разделе HKLM. Процессы без повышенных привилегий всегда записывают изменения в HKLM в незащищенный COW в разделе HKCU\\Software\\Classes. Когда приложение считывает изменения из раздела реестра HKLM, в процессах с повышенными привилегиями будут прочитаны изменения из безопасного COW в разделе HKLM. Непривилегированные операции чтения из обоих двух и повышают вероятность изменений, внесенных в небезопасных COW.

### Сквозные ключи

С помощью сквозных ключей администратор может настроить определенные ключи таким образом, чтобы они могли быть прочитаны только из собственного реестра, минуя пакеты и расположения COW. Транзитные расположения являются глобальными для компьютера (но не для определенного пакета), и его можно настроить, добавив путь к разделу, который должен обрабатываться как проход к параметру **reg \ _MULTI \ _SZ** , именуемому **PassThroughPaths** для ключа `HKLM\Software\Microsoft\AppV\Subsystem\VirtualRegistry` . Любые клавиши, которые отображаются в этом многострочном значении (и их дочерних элементах), обрабатываются как сквозные.

Следующие расположения по умолчанию настроены как транзитные.

-   HKEY \ _CURRENT \ _USER \\SOFTWARE\\Classes\\Local Settings\\Software\\Microsoft\\Windows\\CurrentVersion\\AppModel

-   HKEY \ _LOCAL \ _MACHINE \\SOFTWARE\\Classes\\Local Settings\\Software\\Microsoft\\Windows\\CurrentVersion\\AppModel

-   HKEY \ _LOCAL \ _MACHINE \\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WINEVT

-   HKEY \ _LOCAL \ _MACHINE \\SYSTEM\\CurrentControlSet\\services\\eventlog\\Application

-   HKEY \ _LOCAL \ _MACHINE \\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger

-   HKEY \ _CURRENT \ _USER параметров \\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet

-   HKEY \ _LOCAL \ _MACHINE \\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Perflib

-   HKEY \ _LOCAL \ _MACHINE \\SOFTWARE\\Policies

-   HKEY \ _CURRENT \ _USER \\SOFTWARE\\Policies

Цель сквозных ключей заключается в том, чтобы виртуальное приложение не записывало данные реестра в VReg, которое требуется для невиртуальных приложений для успешной работы или интеграции. Ключ "политики" гарантирует, что параметры групповой политики, заданные администратором, используются и не предназначены для настройки пакетов. Для интеграции с приложениями Windows на базе пользовательского интерфейса требуется ключ AppModel. Рекомендуется, чтобы администрирование не изменялись по умолчанию ни один из входных ключей, но в некоторых случаях в зависимости от поведения приложения может потребоваться добавить дополнительные сквозные ключи.

## <a href="" id="bkmk-pkg-store-behavior"></a>Поведение хранилища пакетов App-V


Приложение App-V 5 управляет хранилищем пакетов, то есть расположением, в котором хранятся развернутые файлы ресурсов из AppV-файла. По умолчанию это расположение хранится на%ProgramData%\\App-V и ограничено возможностями хранения только за счет свободного места на диске. Хранилище пакетов упорядочивается по идентификаторам GUID для пакета и версии, как упоминалось в предыдущем разделе.

### Добавление пакетов

Пакеты App-V помещаются на этапе добавления к компьютеру с помощью клиента App-V. Клиент App-V обеспечивает промежуточное хранение по запросу. При публикации или добавлении вручную в AppVClientPackage структура данных строится в магазине пакетов (c:\\programdata\\App-V\\{PkgGUID}\\{VerGUID}). Файлы пакетов, определенные в блоке публикации, определенном в StreamMap.xml, добавляются в систему и папки верхнего уровня и дочерние файлы для обеспечения существования соответствующих ресурсов приложения при запуске.

### Монтирование пакетов

Пакеты можно загрузить явным образом с помощью PowerShell `Mount-AppVClientPackage` или с помощью **клиентского интерфейса App-V** для загрузки пакета. Эта операция полностью загружает весь пакет в хранилище пакетов.

### Потоковые пакеты

Клиент App-V может быть настроен для изменения поведения потоковой передачи по умолчанию. Все политики потоковой передачи хранятся в следующем разделе реестра: `HKEY_LOCAL_MAcHINE\Software\Microsoft\AppV\Client\Streaming` . Политики задаются с помощью командлета PowerShell `Set-AppvClientConfiguration` . Для потоковой передачи данных применяются следующие политики:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Политика</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>AllowHighCostLaunch</p></td>
<td align="left"><p>В Windows 8 и более поздних версиях это позволяет выполнять потоковую передачу в сетях 3G и сотовой сети</p></td>
</tr>
<tr class="even">
<td align="left"><p>AutoLoad</p></td>
<td align="left"><p>Задает параметр загрузки в фоновом режиме.</p>
<p><strong>0 </strong> - отключено</p>
<p><strong>1 </strong> — только ранее использованные пакеты</p>
<p><strong>2 </strong> — все пакеты</p></td>
</tr>
<tr class="odd">
<td align="left"><p>PackageInstallationRoot</p></td>
<td align="left"><p>Корневая папка для хранилища пакетов на локальном компьютере.</p></td>
</tr>
<tr class="even">
<td align="left"><p>PackageSourceRoot</p></td>
<td align="left"><p>Переопределение корневого элемента, из которого должны передаваться пакеты.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SharedContentStoreMode</p></td>
<td align="left"><p>Включает использование общего хранилища содержимого для сценариев VDI.</p></td>
</tr>
</tbody>
</table>

 

 

Эти параметры влияют на поведение потоковых ресурсов пакета App-V в клиенте. По умолчанию для App-V загружаются только ресурсы, необходимые после загрузки первоначальных функциональных блоков публикации и основного. Потоковые пакеты, которые необходимо объяснить, имеют три конкретных поведения:

-   Фоновая потоковая передача

-   Оптимизированная потоковая передача

-   Ошибки потока

### Фоновая потоковая передача

Командлет PowerShell `Get-AppvClientConfiguration` можно использовать для определения текущего режима фоновой передачи данных с помощью параметра AutoLoad и его изменения с помощью командлета Set-AppvClientConfiguration или в реестре (ключ HKLM\\SOFTWARE\\Microsoft\\AppV\\ClientStreaming). Фоновая потоковая передача — это параметр по умолчанию, в котором для параметра autoload задано значение Загрузка ранее использованных пакетов. Поведение, основанное на параметре по умолчанию (Value = 1), загружает блоки данных App-V в фоновом режиме после запуска приложения. Этот параметр может быть отключен вместе (value = 0) или включен для всех пакетов (Value = 2), независимо от того, были ли они запущены.

### Оптимизированная потоковая передача

Пакеты App-V можно настроить с помощью основного блока функций во время последовательности. Этот параметр позволяет инженеру по виртуализации отслеживать файлы запуска для определенного приложения или приложения, а также помечать блоки данных в пакете App-V для потоковой передачи при первом запуске любого приложения в пакете.

### Ошибки потока

После первоначального потока любых публикуемых данных и основного блока функций запросы на дополнительные файлы выполняют ошибки потока. Эти блоки данных загружаются в хранилище пакетов по мере необходимости. Это позволяет пользователю загружать только небольшие части пакета, как правило, для запуска пакета и выполнения обычных задач. Все остальные блоки загружаются, когда пользователь инициирует операцию, для которой требуются данные, не находящиеся в хранилище пакетов.

Дополнительные сведения о потоковой передаче пакетов App-V: <https://go.microsoft.com/fwlink/?LinkId=392770> .

Последовательность оптимизации потоков можно найти по адресу: <https://go.microsoft.com/fwlink/?LinkId=392771> .

### Обновления пакетов

Пакеты App-V требуют обновления в течение всего жизненного цикла приложения. Обновления пакетов App-V похожи на операцию публикации пакета, так как каждая версия будет создана в отдельном расположении PackageRoot: `%ProgramData%\App-V\{PkgGUID}\{newVerGUID}` . Действие по обновлению оптимизируется путем создания жесткой ссылки на идентичные и потоковые файлы из других версий одного и того же пакета.

### Удаление пакета

Поведение клиента App-V при удалении пакетов зависит от метода, используемого для удаления. С помощью полной инфраструктуры App-V для отмены публикации приложения удаляются файлы каталога пользователей (каталог компьютера для глобальных опубликованных приложений), но сохраняются расположение хранилища пакетов и COWые места. При использовании командлета PowerShell `Remove-AppVClientPackge` для удаления пакета App-V место в хранилище пакетов очищается. Следует помнить, что отмена публикации пакета App-V с сервера управления не приводит к выполнению операции удаления. Ни одна из операций не приведет к удалению файлов пакета магазина пакетов.

## <a href="" id="bkmk-roaming-reg-data"></a>Перемещаемый реестр и данные


Приложение App-V 5 может обеспечивать практически собственный интерфейс при роуминге, в зависимости от того, как написано приложение. По умолчанию App-V перемещает AppData, хранящийся в перемещаемом расположении, в зависимости от конфигурации роуминга операционной системы. Другие расположения для хранения данных на основе файлов не перемещаются с компьютера на компьютер, так как они находятся в неперемещаемых местах.

### <a href="" id="bkmk-clt-inter-roam-reqs"></a>Требования к роумингу и хранилище данных в каталоге пользователей

App-V хранит данные, которые представляют состояние каталога пользователя, в форме:

-   Файлы в разделе%appdata%\\Microsoft\\AppV\\Client\\Catalog

-   Параметры реестра в разделе `HKEY_CURRENT_USER\Software\Microsoft\AppV\Client\Packages`

Вместе эти файлы и параметры реестра представляют каталог пользователя, поэтому оба должны быть перемещены либо ни один из них не должен перемещаться для определенного пользователя. Приложение App-V не поддерживает перемещаемые% AppData%, но не перенаносит в себя пользовательский профиль (реестр) или наоборот.

**Примечание**  Командлет **Repair-AppvClientPackage** не восстанавливает состояние публикации пакетов, где состояние App-V `HKEY_CURRENT_USER` отсутствует или не совпадает с данными в% AppData%.

 

### Данные на основе реестра

Роуминг в реестре App-V состоит из двух сценариев, как показано в приведенной ниже таблице.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Сценарий</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Приложения, которые выполняются как обычные пользователи</p></td>
<td align="left"><p>Когда стандартный пользователь запускает приложение App-V, в кусте HKCU на компьютере сохраняются как HKLM, так и HKCU для приложений App-V. Это два отдельных пути.</p>
<ul>
<li><p>HKLM: HKCU\SOFTWARE\Classes\AppV\Client\Packages {PkgGUID} \ REGISTRY\MACHINE\SOFTWARE</p></li>
<li><p>HKCU: HKCU\SOFTWARE\Microsoft\AppV\Client\Packages {PkgGUID} \ REGISTRY\USER {о} \ программное обеспечение</p></li>
</ul>
<p>Для расположения разрешено перемещение на основе параметров операционной системы.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Приложения, запускаемые с повышением прав</p></td>
<td align="left"><p>При запуске приложения с повышением прав:</p>
<ul>
<li><p>Данные HKLM хранятся в кусте HKLM на локальном компьютере.</p></li>
<li><p>Данные HKCU хранятся в пользовательском расположении реестра.</p></li>
</ul>
<p>В этом случае эти параметры не будут перемещаться с помощью обычных перемещаемых конфигураций операционной системы, а полученные разделы и значения реестра будут храниться в следующем расположении:</p>
<ul>
<li><p>HKLM\SOFTWARE\Microsoft\AppV\Client\Packages {PkgGUID} {.\n\n-} \ REGISTRY\MACHINE\SOFTWARE</p></li>
<li><p>HKCU\SOFTWARE\Microsoft\AppV\Client\Packages {PkgGUID} \ Registry\User {.\n\n-} \ программное обеспечение</p></li>
</ul></td>
</tr>
</tbody>
</table>

 

### Перенаправление для App-V и папок

Приложение App-V 5,1 поддерживает перенаправление папок в перемещаемой папке AppData (% AppData%). При запуске виртуальной среды состояние роуминга AppData из папки перемещаемой AppData копируется в локальный кэш. И наоборот, при завершении работы виртуальной среды локальный кэш, связанный с перемещаемой AppData, будет передаваться в фактическое расположение папки с перемещаемой AppData пользователя.

У типичного пакета есть несколько местоположений, сопоставленных в резервном хранилище пользователя для параметров в AppData\\Local и AppData\\Roaming. Эти расположения предназначены для копирования на место, которое хранится на каждом пользователе в профиле пользователя и используются для хранения изменений, внесенных в каталоги VFS и для защиты пакета по умолчанию VFS.

В следующей таблице показаны локальные и перемещаемые расположения, если перенаправление папок не реализовано.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">VFS Directory в пакете</th>
<th align="left">Сопоставленное расположение резервного хранилища</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>ProgramFilesX86</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Местная </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \ProgramFilesX86</p></td>
</tr>
<tr class="even">
<td align="left"><p>SystemX86</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Местная </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \SystemX86</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Windows</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Местная </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \Windows</p></td>
</tr>
<tr class="even">
<td align="left"><p>appv_ROOT</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Местная </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \ appv_ROOT</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AppData</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; сильное &gt; роуминг </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \AppData</p></td>
</tr>
</tbody>
</table>

 

 

В следующей таблице показаны локальные и перемещаемые расположения, если перенаправление папки реализовано для% AppData%, а расположение было перенаправлено (обычно — в сетевое расположение).

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">VFS Directory в пакете</th>
<th align="left">Сопоставленное расположение резервного хранилища</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>ProgramFilesX86</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Местная </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \ProgramFilesX86</p></td>
</tr>
<tr class="even">
<td align="left"><p>SystemX86</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Местная </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \SystemX86</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Windows</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Местная </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \Windows</p></td>
</tr>
<tr class="even">
<td align="left"><p>appv_ROOT</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Местная </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \ appv_ROOT</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AppData</p></td>
<td align="left"><p><strong>\Fileserver </strong> \users\jsmith\roaming\Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \AppData</p></td>
</tr>
</tbody>
</table>

 

 

Текущий драйвер VFS клиента App-V не может записать в сеть, поэтому клиент App-V обнаруживает наличие перенаправления папок и копирует данные на локальном диске во время публикации и при запуске виртуальной среды. После того как пользователь закроет приложение App-V, а клиент App-V закроет виртуальную среду, локальное хранилище VFS AppData копируется в сеть, позволяя перемещаться на дополнительные компьютеры, где процесс будет повторен. Ниже приведены подробные инструкции по выполнению процессов.

1.  При запуске публикации или виртуальной среды клиент App-V обнаруживает расположение каталога AppData.

2.  Если путь для перемещаемой AppData является локальным или INO AppData\\Roaming расположением, ничего не происходит.

3.  Если путь к перемещаемой папке AppData не является локальным, каталог AppData VFS будет сопоставлен с каталогом локальных AppData.

Этот процесс решает проблему, связанную с нелокальной% AppData%, которая не поддерживается драйвером клиента App-V VFS. Однако данные, хранящиеся в этом новом расположении, не перемещаются с помощью перенаправления папок. Все изменения, внесенные во время выполнения приложения, происходят в локальной папке AppData и должны быть скопированы в перенаправленное расположение. Ниже приведено подробное описание этой процедуры.

1.  Приложение App-V завершает работу, что закрывает виртуальную среду.

2.  Локальный кэш перемещаемой папки AppData сжимается и сохраняется в ZIP-файле.

3.  Для присвоения имени файлу используется метка времени в конце процесса упаковки ZIP.

4.  Метка времени записывается в реестр: HKEY \ _CURRENT \ _USER \\Software\\Microsoft\\AppV\\Client\\Packages\\ &lt; GUID &gt; \\AppDataTime как последнюю известную временную метку APPDATA.

5.  Процесс перенаправления папок вызывается для оценки и инициализации ZIP-файла, отправленного в каталог роуминга AppData.

Метка времени используется для определения сценария последнего составителя, если возник конфликт и используется для оптимизации загрузки данных при публикации приложения App-V или при запуске виртуальной среды. Перенаправление папок обеспечивает доступ к данным на всех клиентах, охваченных поддержкой политики поддержки, и инициирует процесс сохранения данных AppData\\Roaming в локальной папке AppData на клиенте. Ниже описаны подробные процессы.

1.  Пользователь запускает виртуальную среду, запустив приложение.

2.  Виртуальная среда приложения проверяет, не был ли последний сжатый ZIP-файл, если таковой имеется.

3.  Реестр проверяются на наличие последней известной отметкой времени (если она есть).

4.  Последний ZIP-файл загружается за исключением тех случаев, когда локальная последняя известная отметка времени отправки больше или равна отметке времени из ZIP-файла.

5.  Если локальная последняя известная отметка времени отправки более ранняя, чем последняя ZIP-файл в расположении для перемещаемой оснастки, ZIP-файл извлекается в локальный временный каталог в профиле пользователя.

6.  После успешного извлечения ZIP-файла локальный кэш перемещаемой папки AppData переименовывается, и новые данные перемещаются на место.

7.  Переименованный каталог удаляется, а приложение открывается с использованием последнего сохраненного данных роуминга AppData.

Это завершит успешное перемещение параметров приложения, которые присутствуют в AppData\\Roaming местоположений. Единственным другим условием, которое необходимо устранить, является операция восстановления пакета. Сведения о процессе:

1.  Во время восстановления определите, не является ли путь к каталогу перемещаемой AppData пользователя локальным.

2.  Сопоставьте нелокальные целевые объекты пути AppData с роумингом повторно.

3.  Удаление метки времени, хранящейся в реестре, если она есть.

Этот процесс заново создаст локальные и сетевые расположения для AppData и удалит запись реестра для временной метки.

## <a href="" id="bkmk-clt-app-lifecycle"></a>Управление жизненным циклом в клиентском приложении App-V


В полной инфраструктуре App-V после упорядочения приложений они управляются и публикуются для пользователей и компьютеров с помощью управления App-V и сервера публикаций. В этом разделе описаны операции, возникающие при выполнении общих операций жизненного цикла приложения App-V (Добавление, публикация, запуск, обновление и удаление), а также файлов и расположений реестра, измененных и измененных с точки зрения клиента App-V. Клиентские операции App-V выполняются как серии команд PowerShell, инициированных на компьютере, на котором запущен клиент App-V.

В этом документе основное внимание уделяется решениям для всех инфраструктур App-V. Подробные сведения о интеграции App-V и Configuration Manager 2012: <https://go.microsoft.com/fwlink/?LinkId=392773> .

Задачи жизненного цикла приложения App-V запускаются при входе пользователя (по умолчанию), запуске компьютера или в фоновом режиме. Параметры клиентских операций App-V, в том числе серверы публикации, интервалы обновления, включение и использование сценария пакета, задаются во время настройки клиента или после установки с помощью команд PowerShell. Сведения о том, как [развернуть клиент App-V](how-to-deploy-the-app-v-client-51gb18030.md) или использовать PowerShell, можно найти в разделе Развертывание клиента в TechNet.

```powershell
get-command *appv*
```

### Обновление публикации

Процесс обновления публикации состоит из нескольких операций с небольшим объемом, которые выполняются в клиенте App-V. Поскольку App-V — это технология виртуализации приложений, а не технология планирования задач, планировщик заданий Windows используется для включения процесса при входе пользователя в систему, запуске компьютера и в запланированные интервалы. Настройка клиента в указанных выше случаях является предпочтительным способом при распространении клиента на большую группу компьютеров с правильными параметрами. Эти параметры клиента можно настроить с помощью следующих командлетов PowerShell:

-   **Add-AppVPublishingServer:** Настраивает Клиент с помощью сервера публикаций App-V, предоставляющего пакеты App-V.

-   **Set-AppVPublishingServer:** Изменение текущих параметров для сервера публикаций App-V.

-   **Set-AppVClientConfiguration:** Изменяет параметры текущих параметров для клиента App-V.

-   **Sync (синхронизация) — AppVPublishingServer:** Инициирует процесс обновления публикации App-V вручную. Это также используется в запланированных задачах, созданных при настройке сервера публикаций.

В следующих разделах описаны действия, которые выполняются на разных этапах обновления публикации для App-V. В этой статье рассматриваются следующие темы:

-   Добавление пакета App-V

-   Публикация пакета App-V

### Добавление пакета App-V

Добавление пакета App-V на клиент — это первый этап процесса обновления публикации. Конечный результат совпадает с `Add-AppVClientPackage` командлетом в PowerShell (за исключением случаев, когда процесс добавления обновления публикации) отвечает на настроенный сервер публикации и передает ему высокоуровневый список приложений обратно клиенту для получения более подробных сведений, а не одной операции добавления пакета. Процесс продолжается путем настройки клиента для добавления или обновления группы или подключения, а затем для доступа к файлу AppV. Затем содержимое AppV файла разворачивается и размещается в локальной операционной системе в соответствующих расположениях. Ниже приведен подробный рабочий процесс процесса, предполагая, что пакет настроен для потоковой передачи ошибок.

**Добавление пакета App-V**

1.  Ручная Инициация с помощью PowerShell или инициации последовательности задач процесса обновления публикации.

    1.  Клиент App-V делает соединение HTTP и запрашивает список приложений на основе целевого объекта. Процесс обновления публикации поддерживает целевые компьютеры или пользователей.

    2.  Сервер публикации App-V использует идентификацию целевого объекта, пользователя или компьютера, а также запрос к базе данных для списка приложений, имеющих право. Список приложений предоставляется в виде ответа XML, который используется клиентом для отправки дополнительных запросов на сервер для получения дополнительных сведений о каждом пакете.

2.  Агент публикаций в клиенте App-V выполняет все действия, приведенные ниже.

    Оценка всех групп подключений, которые не опубликованы или отключены, так как обновления версии пакетов, которые являются частью группы подключения, не могут быть обработаны.

3.  Настройте пакеты, определив операции добавления или обновления.

    1.  Клиент App-V использует API AppX из Windows и обращается к файлу AppV с сервера публикаций.

    2.  Файл пакета открывается, а AppXManifest.xml и StreamMap.xml загружаются в хранилище пакетов.

    3.  Полностью потоковые данные блока публикации, определенные в StreamMap.xml. Хранит данные блока публикации в пакете Store\\PkgGUID\\VerGUID\\Root.

        -   Значки: целевые точки расширения.

        -   Переносимые заголовки (заголовков PE): целевые точки расширения, которые содержат базовые сведения о том, что изображение должно быть доступно на диске, непосредственно из него или с помощью типов файлов.

        -   Сценарии: скачивание каталога сценариев для использования во время публикации.

    4.  Заполните хранилище пакетов.

        1.  Создавайте разреженные файлы на диске, представляющие извлеченный пакет для всех указанных каталогов.

        2.  Файлы и каталоги верхнего уровня в корневом каталоге рабочей области.

        3.  Все остальные файлы создаются в том случае, если папка указана как разреженные на диске и потоковая передача по запросу.

    5.  Создайте записи каталога компьютеров. Создавайте Manifest.xml и DeploymentConfiguration.xml из файлов пакета (если в пакете не создан файл DeploymentConfiguration.xml).

    6.  Создание места хранения пакетов в реестре HKLM\\Software\\Microsoft\\AppV\\Client\\Packages\\PkgGUID\\Versions\\VerGUID\\Catalog

    7.  Создайте файл Registry. dat из хранилища пакетов в%ProgramData%\\Microsoft\\AppV\\Client\\VReg\\ {VersionGUID}. dat

    8.  Регистрация пакета с помощью драйвера режима ядра App-V HKLM\\Microsoft\\Software\\AppV\\MAV

    9.  Вызовите сценарии из файла AppxManifest.xml или DeploymentConfig.xml, чтобы добавить время добавления пакета.

4.  Настройка групп подключений путем добавления и включения и отключения.

5.  Удаляйте объекты, которые не опубликованы в целевом объекте (пользователь или компьютер).

    **Примечание**  Это не приведет к удалению пакета и удалению точек интеграции для определенного целевого объекта (пользователя или компьютера) и удаления файлов каталога пользователей (файлы каталога компьютера для публикации в глобальном каталоге).

     

6.  Вызвать монтирование фоновой нагрузки на основе конфигурации клиента;

7.  Пакеты, у которых уже есть сведения о публикации для компьютера или пользователя, немедленно восстанавливаются.

    **Примечание**  Это условие выполняется как произведение удаления без отмены публикации в фоновом добавлении пакета.

     

После этого пакет App-V добавляет процесс обновления публикации. Следующий шаг — Публикация пакета для определенного целевого объекта (компьютера или пользователя).

![Упаковка добавления файлов и данных реестра](images/packageaddfileandregistrydata.png)

### Публикация пакета App-V

В ходе операции обновления публикации определенная операция публикации (Publish-AppVClientPackage) добавляет записи в пользовательский каталог, сопоставляет данные с пользователем, определяет локальное хранилище и завершает работу, выполняя все этапы интеграции. Ниже приведены подробные инструкции.

**Публикация пакета App-V**

1.  Записи пакетов добавляются в каталог пользователей

    1.  Пакеты, предназначенные для пользователей: UserDeploymentConfiguration.xml и UserManifest.xml размещаются на компьютере в каталоге пользователей.

    2.  Целевые (глобальные) пакеты для компьютера: UserDeploymentConfiguration.xml помещено в каталог компьютера;

2.  Регистрация пакета с помощью драйвера режима ядра для пользователя на HKLM\\Software\\Microsoft\\AppV\\MAV

3.  Выполнение задач интеграции.

    1.  Создание точек расширения.

    2.  Храните резервные копии в реестре пользователя и перемещаемом профиле (Архивация ярлыков).

        **Примечание**  Это позволяет восстановить точки расширения, если пакет не опубликован.

         

    3.  Выполнение сценариев, предназначенных для синхронизации публикации.

Публикация пакета App-V, который входит в группу соединения, очень похожа на описанный выше процесс. Для групп подключений путь, хранящий определенную информацию о каталоге, включает PackageGroups в качестве дочернего элемента каталога каталога. Ознакомьтесь со сведениями о каталоге компьютеров и пользователей выше, чтобы получить подробные сведения.

![пакет добавляет данные файлов и реестра — Global](images/packageaddfileandregistrydata-global.png)

### Запуск приложения

После обновления публикации пользователь запускается и затем повторно запускает приложение App-V. Процесс очень прост и оптимизирован для быстрого запуска с минимальным объемом сетевого трафика. Клиент App-V проверяет путь к каталогу пользователей для файлов, создаваемых во время публикации. После установления прав на запуск пакета клиент App-V создает виртуальную среду, начинает потоковую передачу необходимых данных и применяет соответствующие файлы конфигурации манифеста и развертывания во время создания виртуальной среды. С помощью виртуальной среды, созданной и настроенной для определенного пакета и приложения, запускается приложение.

**Запуск приложений App-V**

1.  Пользователь запускает приложение, щелкая ярлык или тип файла.

2.  Клиент App-V проверяет наличие указанных ниже файлов в каталоге пользователей.

    -   UserDeploymentConfiguration.xml

    -   UserManifest.xml

3.  Если файлы находятся в списке, это значит, что приложение предназначено для определенного пользователя, и приложение запустит процесс для запуска. На этом этапе отсутствует сетевой трафик.

4.  Затем клиент App-V проверяет, является ли путь к пакету, зарегистрированному для службы клиента App-V, найденным в реестре.

5.  После того как вы нашли путь к хранилищу пакетов, создается виртуальная среда. Если это первый запуск, основной блок функций загружается, если таковой имеется.

6.  После загрузки служба клиента App-V использует файлы конфигурации манифеста и развертывания для настройки виртуальной среды и загрузки всех подсистем App-V.

7.  Запускается приложение. Для любых отсутствующих файлов в хранилище пакетов (разреженные файлы) приложение App-V будет перезаписывать ошибки файлов по мере необходимости.

    ![пакет добавить данные файла и реестра — Stream](images/packageaddfileandregistrydata-stream.png)

### Обновление пакета App-V

Процесс обновления пакета App-V 5 отличается от предыдущих версий App-V. Приложение App-V поддерживает несколько версий одного пакета на компьютере, предназначенном для разных пользователей. Версии пакетов можно добавлять в любое время, так как в магазине и каталоги пакетов будут обновляться с учетом новых ресурсов. Единственный процесс, относящийся к добавлению новых ресурсов версий, — это Оптимизация хранилища. Во время обновления в новом расположении в хранилище версий добавляются только новые файлы, а для файлов с неизмененными изменениями создаются жесткие ссылки. Это уменьшает общее хранилище, выводит файл только на одном диске, а затем проецирование во все папки с помощью записи расположения файла на диске. Ниже указаны некоторые сведения об обновлении пакета App-V.

**Обновление пакета App-V**

1.  Клиент App-V выполняет обновление публикации и открывают более новую версию пакета App-V.

2.  Записи пакета добавляются в соответствующий каталог для новой версии

    1.  Пакеты, предназначенные для пользователей: UserDeploymentConfiguration.xml и UserManifest.xml размещаются на компьютере в каталоге пользователей по адресу appdata\\roaming\\Microsoft\\AppV\\Client\\Catalog\\Packages\\PkgGUID\\VerGUID

    2.  Целевые (глобальные) пакеты для компьютера: UserDeploymentConfiguration.xml помещены в каталог Machine по адресу%programdata%\\Microsoft\\AppV\\Client\\Catalog\\Packages\\PkgGUID\\VerGUID

3.  Регистрация пакета с помощью драйвера режима ядра для пользователя на HKLM\\Software\\Microsoft\\AppV\\MAV

4.  Выполнение задач интеграции.

    -   Интегрируйте точки расширения (EP) из файлов манифеста и динамической конфигурации.

    1.  Данные EP на основе файлов хранятся в папке AppData с использованием точек соединения из хранилища пакетов.

    2.  Если новая версия станет доступна, Внешняя спецификация версии 1 уже существует.

    3.  Точки расширения переключаются на расположение версии 2 в каталогах компьютеров или пользователей для новых или обновленных точек расширения.

5.  Выполнение сценариев, предназначенных для синхронизации публикации.

6.  Устанавливайте параллельные сборки по мере необходимости.

### Обновление используемого пакета App-V

**Начиная с версии App-V 5 SP2**: при попытке обновить пакет, который используется конечным пользователем, задача обновления будет находиться в состоянии ожидания. Обновление будет запущено позже в соответствии с приведенными ниже правилами.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Тип задачи</th>
<th align="left">Применимое правило</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Пользовательская задача, например Публикация пакета для пользователя</p></td>
<td align="left"><p>Задача будет выполнена после того, как пользователь войдет в систему, а затем снова войдите в нее.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Глобально на основе задач, например включение глобальной группы подключения</p></td>
<td align="left"><p>Задача, ожидающая выполнения, будет выполнена после отключения компьютера и повторного запуска.</p></td>
</tr>
</tbody>
</table>

 

Когда задача размещается в состоянии ожидания, клиент App-V также создает раздел реестра для задачи с отложенным вводом, как описано ниже.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Задача на основе пользователей или глобально</th>
<th align="left">Где создается раздел реестра</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Пользовательские задачи</p></td>
<td align="left"><p>KEY_CURRENT_USER \Software\Microsoft\AppV\Client\PendingTasks</p></td>
</tr>
<tr class="even">
<td align="left"><p>Глобально на основе задач</p></td>
<td align="left"><p>HKEY_LOCAL_MACHINE \Software\Microsoft\AppV\Client\PendingTasks</p></td>
</tr>
</tbody>
</table>

 

Прежде чем пользователи смогут использовать новую версию пакета, необходимо выполнить следующие действия:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Задача</th>
<th align="left">Сведения</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Добавление пакета на компьютер</p></td>
<td align="left"><p>Эта задача предназначена для определенного компьютера, и вы можете сделать это в любое время, выполнив действия, описанные в разделе Добавление пакета выше.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Публикация пакета</p></td>
<td align="left"><p>Инструкции приведены в разделе Публикация пакетов выше. Для этого процесса требуется обновить точки расширения в системе. Конечные пользователи не могут использовать приложение, когда вы закончите эту задачу.</p></td>
</tr>
</tbody>
</table>

 

Воспользуйтесь приведенными ниже примерами сценариев в качестве руководства по обновлению пакетов.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Сценарий</th>
<th align="left">Требования</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Пакет App-V не используется при попытке обновления</p></td>
<td align="left"><p>Ни один из следующих компонентов пакета не может быть использован: виртуальное приложение, COM-сервер или расширения оболочки.</p>
<p>Администратор публикует более новую версию пакета, и обновление работает при следующем запуске компонента или приложения в пакете. Новая версия пакета помещается в поток и выполняется. В этом сценарии ничего не изменилось в App-V 5 SP2 из предыдущих выпусков App-V 5.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Пакет App-V используется, когда администратор публикует более новую версию пакета</p></td>
<td align="left"><p>Для операции обновления установлен режим ожидания клиента App-V, что означает, что он находится в очереди и выполняется позже, когда пакет не используется.</p>
<p>Если приложение пакета используется, пользователь закрывает виртуальное приложение, после чего может происходить обновление.</p>
<p>Если в пакете есть расширения оболочки (Office 2013), которые окончательно загружаются проводником Windows, пользователь не может войти в систему. Пользователи должны выйти из системы и снова войти в систему, чтобы начать обновление пакета App-V.</p></td>
</tr>
</tbody>
</table>

 

### Глобальная публикация пользователей и групп

Пакеты App-V можно публиковать одним из двух способов: Пользователь, который имеет право на доступ пакета App-V к определенному пользователю или группе пользователей и глобальным пользователям, которые имеют доступ к пакету App-V для всего компьютера для всех пользователей компьютера. После завершения обновления пакета, если пакет App-V не используется, рассматривайте два типа публикации:

-   **Опубликовано глобально**: приложение опубликовано на компьютере; все пользователи на этом компьютере могут использовать его. Обновление происходит при запуске клиентской службы App-V, что фактически означает перезагрузку компьютера.

-   **Опубликованные пользователи**: приложение опубликовано для пользователя. Если на компьютере несколько пользователей, приложение можно опубликовать в подмножестве пользователей. Обновление происходит при входе пользователя в систему или при повторной его публикации (периодическое обновление политики ConfigMgr, его оценка или периодическая публикация и обновление приложения-V или явное применение команд PowerShell).

### Удаление пакета App-V

Удаление приложений App-V в полной инфраструктуре является операцией отмены публикации и не выполняет удаление пакета. Процесс аналогичен процессу публикации, но вместо добавления процесса удаления изменяет изменения, внесенные в пакеты App-V.

### Восстановление пакета App-V

Операция восстановления очень проста, но может повлиять на многие места на компьютере. Ранее указанные места в разделе "запись (COW)" удаляются, а точки расширения становятся неинтегрированными, а затем снова интегрируются. Просмотрите места расположения данных COW, просмотрев, где они зарегистрированы в реестре. Эта операция выполняется автоматически, но отсутствует административный элемент управления, не управляющий операцией восстановления на клиентской консоли App-V или через PowerShell (Repair-AppVClientPackage).

## <a href="" id="bkmk-integr-appv-pkgs"></a>Интеграция пакетов App-V


Архитектура клиента и пакета App-V обеспечивает определенную интеграцию с локальной операционной системой во время добавления и публикации пакетов. Три файла определяют точки интеграции или расширения для пакета App-V.

-   AppXManifest.xml: хранимые в пакете резервные копии, хранящиеся в хранилище пакетов и в профиле пользователя. Содержат параметры, созданные в процессе упорядочивания.

-   DeploymentConfig.xml: предоставляет сведения о конфигурации точек расширения интеграции на компьютере и на основе пользователей.

-   UserConfig.xml: подмножество Deploymentconfig.xml, предоставляющее только пользовательские конфигурации и предназначенные только целевые точки расширения на основе пользователей.

### Правила интеграции

Когда приложения App-V публикуются на компьютере с клиентом App-V, выполняются некоторые действия, описанные в приведенном ниже списке.

-   Глобальная публикация: сочетания клавиш хранятся в расположении профиля "все пользователи", а другие точки расширения хранятся в реестре куста HKLM.

-   Публикация пользователей: сочетания клавиш хранятся в текущем профиле учетной записи пользователя, а другие точки расширения хранятся в реестре в кусте HKCU.

-   Резервное копирование и восстановление: существующие данные собственного приложения и реестр (например, регистрация FTA) записываются в резервную копию во время публикации.

    1.  Пакеты App-V получают владение на основе последнего интегрированного пакета, в котором владение передается в последнее опубликованное приложение App-V.

    2.  Передача владения из одного пакета App-V в другой при публикации пакета App-V. Это не приведет к восстановлению данных или реестра.

    3.  Восстановление заархивированных данных при разпубликации и удалении последнего пакета для каждой точки расширения.

### Точки расширения

Файлы публикации App-V (манифест и динамическая конфигурация) предоставляют несколько точек расширения, которые позволяют приложению интегрироваться с локальной операционной системой. Эти точки расширения выполняют типичные задачи по установке приложений, такие как размещение сочетаний клавиш, создание сопоставлений типов файлов и регистрация компонентов. Так как это виртуализированные приложения, которые не установлены так же, как традиционное приложение, существует ряд отличий. Ниже приведен список точек расширения, описанных в этом разделе.

-   Горячие

-   Сопоставления типов файлов

-   Расширения оболочки

-   НАДСТРОЙК

-   Клиенты программного обеспечения

-   Возможности приложения

-   Обработчик протокола URL-адреса

-   AppPath

-   Виртуальное приложение

### Горячие

Краткое вырезание — это один из основных элементов интеграции с ОС и является интерфейсом для непосредственного запуска приложения App-V. Во время публикации и отмены публикации приложений App-V.

Из манифеста пакета и XML-файлов динамической конфигурации путь к определенному исполняемому файлу приложения можно найти в разделе, аналогичном следующему:

```xml
<Extension Category="AppV.Shortcut">
          <Shortcut>
            <File>[{Common Desktop}]\Adobe Reader 9.lnk</File>
            <Target>[{AppVPackageRoot}]\Reader\AcroRd32.exe</Target>
            <Icon>[{Windows}]\Installer\{AC76BA86-7AD7-1033-7B44-A94000000001}\SC_Reader.ico</Icon>
            <Arguments />
            <WorkingDirectory />
            <ShowCommand>1</ShowCommand>
            <ApplicationId>[{AppVPackageRoot}]\Reader\AcroRd32.exe</ApplicationId>
          </Shortcut>
        </Extension>
```

Как упоминалось ранее, сочетания клавиш App-V помещаются по умолчанию в пользовательском профиле в соответствии с операцией обновления. Общие сочетания клавиш в профиле All Users и User Refresh хранят их в определенном пользователем профиле. Фактический исполняемый файл хранится в хранилище пакетов. Расположение ICO-файла — это расположение, в котором размещается лексема в пакете App + V.

### Сопоставления типов файлов

Клиент App-V управляет связями типов файлов локальной операционной системы во время публикации, что позволяет пользователям использовать вызовы типов файлов или открывать файлы с особым зарегистрированным расширением (DOCX) для запуска приложения App-V. Сопоставления типов файлов представлены в файлах манифеста и динамической конфигурации, как показано в примере ниже.

```xml
<Extension Category="AppV.FileTypeAssociation">
          <FileTypeAssociation>
            <FileExtension MimeAssociation="true">
              <Name>.xdp</Name>
              <ProgId>AcroExch.XDPDoc</ProgId>
              <ContentType>application/vnd.adobe.xdp+xml</ContentType>
            </FileExtension>
            <ProgId>
              <Name>AcroExch.XDPDoc</Name>
              <Description>Adobe Acrobat XML Data Package File</Description>
              <EditFlags>65536</EditFlags>
              <DefaultIcon>[{Windows}]\Installer\{AC76BA86-7AD7-1033-7B44-A94000000001}\XDPFile_8.ico</DefaultIcon>
              <ShellCommands>
                <DefaultCommand>Read</DefaultCommand>
                <ShellCommand>
                  <ApplicationId>[{AppVPackageRoot}]\Reader\AcroRd32.exe</ApplicationId>
                  <Name>Open</Name>
                  <CommandLine>"[{AppVPackageRoot}]\Reader\AcroRd32.exe" "%1"</CommandLine>
                </ShellCommand>
                <ShellCommand>
                  <ApplicationId>[{AppVPackageRoot}]\Reader\AcroRd32.exe</ApplicationId>
                  <Name>Printto</Name>
                  <CommandLine>"[{AppVPackageRoot}]\Reader\AcroRd32.exe"  /t "%1" "%2" "%3" "%4"</CommandLine>
                </ShellCommand>
                <ShellCommand>
                  <ApplicationId>[{AppVPackageRoot}]\Reader\AcroRd32.exe</ApplicationId>
                  <Name>Read</Name>
                  <FriendlyName>Open with Adobe Reader 9</FriendlyName>
                  <CommandLine>"[{AppVPackageRoot}]\Reader\AcroRd32.exe" "%1"</CommandLine>
                </ShellCommand>
              </ShellCommands>
            </ProgId>
          </FileTypeAssociation>
        </Extension>
```

**Примечание**  В этом примере:

-   `<Name>.xdp</Name>` является расширением

-   `<Name>AcroExch.XDPDoc</Name>` значение ProgId (которое указывает на смежный ProgId)

-   `<CommandLine>"[{AppVPackageRoot}]\Reader\AcroRd32.exe" "%1"</CommandLine>` — Это Командная строка, указывающая на исполняемый файл приложения.

 

### Расширения оболочки

Расширения оболочки встраиваются в пакет автоматически в процессе упорядочивания. Если пакет опубликован глобально, расширение оболочки предоставляет пользователям те же функциональные возможности, что и при локальном установлении приложения. Для включения функций расширения оболочки приложению не требуется дополнительная настройка или Настройка клиента.

**Требования для использования расширений оболочки:**

-   Пакеты, содержащие внедренные расширения оболочки, должны быть опубликованы глобально.

-   "Разрядность" приложения, секвенсора и клиента App-V должны совпадать, или расширения оболочки не работают. Пример

    -   Версия приложения — 64-разр.

    -   Секвенсор выполняется на 64-разрядном компьютере.

    -   Пакет доставляется на клиентский компьютер App-V 64-bit.

В следующей таблице показаны поддерживаемые расширения оболочки.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Обработчик</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Обработчик контекстного меню</p></td>
<td align="left"><p>Добавляет элементы меню в контекстное меню. Вызывается перед отображением контекстного меню.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработчик перетаскивания</p></td>
<td align="left"><p>Управление действием при щелчке правой кнопкой мыши и изменением появившегося контекстного меню.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Целевой обработчик перетаскивания</p></td>
<td align="left"><p>Управляет действием после перетаскивания объекта данных и отбрасываниям по направлению, например к файлу.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработчик объектов данных</p></td>
<td align="left"><p>Управляет действием после того, как файл копируется в буфер обмена или перетаскивается и отбрасывается по направлению перетаскивания. Он может предоставлять дополнительные форматы буфера обмена для целевого объекта перетаскивания.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработчик страницы свойств</p></td>
<td align="left"><p>Заменяет или добавляет страницы в диалоговое окно "страница свойств" объекта.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработчик всплывающих подсказк</p></td>
<td align="left"><p>Позволяет получить сведения о флагах и всплывающих подсказках для элемента и отобразить его в всплывающей подсказке при наведении указателя мыши.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработчик столбцов</p></td>
<td align="left"><p>Позволяет создавать и отображать пользовательские столбцы в представлении "сведения" в проводнике Windows <em> </em> . Его можно использовать для расширенной сортировки и группировки.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработчик просмотра</p></td>
<td align="left"><p>Обеспечивает предварительный просмотр файла, который будет отображаться в области предварительного просмотра в проводнике Windows.</p></td>
</tr>
</tbody>
</table>

 

### НАДСТРОЙК

Клиент App-V поддерживает публикацию приложений с поддержкой интеграции и виртуализации COM. Интеграция COM позволяет клиенту App-V регистрировать COM-объекты в локальной операционной системе и виртуализации объектов. Для целей этого документа интеграция COM-объектов требует дополнительных подробностей.

Приложение App-V поддерживает регистрацию COM-объектов из пакета в локальную операционную систему с двумя типами процессов: вне процесса и внутри процесса. Регистрация COM-объектов выполняется в одном или нескольких режимах работы для определенного пакета App-V, который включает в себя автономный, изолированный и интегрированный. Интегрированный режим настраивается как для, так и для типа внутрипроцессного или внутрипроцессного. Настройка режимов и типов COM осуществляется с помощью динамических файлов конфигурации (deploymentconfig.xml или userconfig.xml).

Подробные сведения о интеграции App-V можно найти по адресу: <https://go.microsoft.com/fwlink/?LinkId=392834> .

### Клиенты программного обеспечения и возможности приложений

Приложение App-V поддерживает конкретные клиенты и точки расширения возможностей приложения, которые позволяют регистрировать виртуализированные приложения с помощью программного клиента операционной системы. Это позволяет пользователям выбирать программы по умолчанию для таких операций, как электронная почта, Обмен мгновенными сообщениями и проигрыватель мультимедиа. Эта операция выполняется на панели управления с помощью настройки доступа к программам и параметров по умолчанию, а также при настройке последовательности в файлах манифеста или динамической конфигурации. Возможности приложения поддерживаются только в том случае, если приложения App-V публикуются глобально.

Пример регистрации клиента программного обеспечения для почтового клиента на базе App-V.

```xml
    <SoftwareClients Enabled="true">
      <ClientConfiguration EmailEnabled="true" />
      <Extensions>
        <Extension Category="AppV.SoftwareClient">
          <SoftwareClients>
            <EMail MakeDefault="true">
              <Name>Mozilla Thunderbird</Name>
              <Description>Mozilla Thunderbird</Description>
              <DefaultIcon>[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe,0</DefaultIcon>
              <InstallationInformation>
                <RegistrationCommands>
                  <Reinstall>"[{ProgramFilesX86}]\Mozilla Thunderbird\uninstall\helper.exe" /SetAsDefaultAppGlobal</Reinstall>
                  <HideIcons>"[{ProgramFilesX86}]\Mozilla Thunderbird\uninstall\helper.exe" /HideShortcuts</HideIcons>
                  <ShowIcons>"[{ProgramFilesX86}]\Mozilla Thunderbird\uninstall\helper.exe" /ShowShortcuts</ShowIcons>
                </RegistrationCommands>
                <IconsVisible>1</IconsVisible>
                <OEMSettings />
              </InstallationInformation>
              <ShellCommands>
                <ApplicationId>[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe</ApplicationId>
                <Open>"[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe" -mail</Open>
              </ShellCommands>
              <MAPILibrary>[{ProgramFilesX86}]\Mozilla Thunderbird\mozMapi32_InUse.dll</MAPILibrary>
              <MailToProtocol>
                <Description>Thunderbird URL</Description>
                <EditFlags>2</EditFlags>
                <DefaultIcon>[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe,0</DefaultIcon>
                <ShellCommands>
                  <ApplicationId>[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe</ApplicationId>
                  <Open>"[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe" -osint -compose "%1"</Open>
                </ShellCommands>
              </MailToProtocol>
            </EMail>
          </SoftwareClients>
        </Extension>
      </Extensions>
    </SoftwareClients>
```

**Примечание**  В этом примере:

-   `<ClientConfiguration EmailEnabled="true" />` — Это общая настройка клиентов по электронной почте для интеграции с клиентами.

-   `<EMail MakeDefault="true">` флаг для настройки определенного почтового клиента в качестве почтового клиента по умолчанию.

-   `<MAPILibrary>[{ProgramFilesX86}]\Mozilla Thunderbird\mozMapi32_InUse.dll</MAPILibrary>` — это регистрация библиотеки MAPI

 

### Обработчик протокола URL-адреса

Приложения не всегда называются виртуализированными приложениями, использующих вызов типов файлов. Например, в приложении, которое поддерживает внедрение ссылки mailto: в документ или веб-страницу, пользователь щелкает ссылку mailto:, и ожидается получение зарегистрированного почтового клиента. App-V поддерживает обработчики протоколов URL-адресов, которые могут быть зарегистрированы для каждого пакета с помощью локальной операционной системы. Во время последовательности обработчики протокола URL-адреса автоматически добавляются в пакет.

В ситуациях, когда имеется более одного приложения, которое может зарегистрировать конкретный обработчик протокола URL-адреса, можно использовать динамические файлы конфигурации для изменения поведения и подавления или отключения этой функции для приложения, которое не должно быть запущено основным приложением.

### AppPath

Точка расширения AppPath поддерживает вызов приложений App-V непосредственно из операционной системы. Обычно это выполняется с экрана запуска или запуска, в зависимости от операционной системы, которая позволяет администраторам предоставлять доступ к приложениям App-V из команд или сценариев операционной системы, не вызывая определенный путь к исполняемому файлу. Таким образом, вы не изменяете переменную среды системного пути во всех системах, так как она выполняется во время публикации.

Точка расширения AppPath настраивается либо в манифесте, либо в файлах динамической конфигурации и хранится в реестре на локальном компьютере во время публикации для пользователя. Дополнительные сведения о AppPath рецензировании: <https://go.microsoft.com/fwlink/?LinkId=392835> .

### Виртуальное приложение

Эта подсистема предоставляет список приложений, собранных в процессе упорядочивания, который обычно используется другими компонентами App-V. Интеграция точек расширения, принадлежащих определенному приложению, может быть отключена с помощью динамических файлов конфигурации. Например, если пакет содержит два приложения, можно отключить все точки расширения, принадлежащие одному приложению, чтобы разрешить только интеграцию точек расширения другого приложения.

### Правила точки расширения

Описанные выше точки расширения интегрированы в операционную систему в зависимости от того, как были опубликованы пакеты. В общедоступных местах публикации, где пользователи публикуют точки расширения в расположениях пользователей, размести расширения. Например, ярлык, созданный на рабочем столе и опубликованный глобально, приведет к созданию данных файла для ярлыка (%Public%\\Desktop) и данных реестра (HKLM\\Software\\Classes). Один и тот же ярлык может иметь данные файла (%UserProfile%\\Desktop) и данные реестра (HKCU\\Software\\Classes).

Точки расширения не публикуются так же, как и для некоторых точек расширения требуется глобальная публикация, а для некоторых из них требуется последовательность для конкретной операционной системы и архитектуры, где они были доставлены. Ниже приведена таблица, в которой описаны эти два ключевых правила.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Виртуальное расширение</th>
<th align="left">Требуется упорядочение целевой операционной системы</th>
<th align="left">Требуется глобальная публикация</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Появивше</p></td>
<td align="left"><p></p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Сопоставление типов файлов</p></td>
<td align="left"><p></p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Протоколы URL-адресов</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>AppPaths</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Режим COM</p></td>
<td align="left"><p></p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Клиент программного обеспечения</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Возможности приложения</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p>X</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработчик контекстного меню</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p>X</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработчик перетаскивания</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработчик объектов данных</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработчик страницы свойств</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработчик всплывающих подсказк</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработчик столбцов</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Расширения оболочки</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Вспомогательный объект браузера</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p>X</p></td>
</tr>
<tr class="even">
<td align="left"><p>Объект Active X</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p>X</p></td>
</tr>
</tbody>
</table>

 

## <a href="" id="bkmk-dynamic-config"></a>Динамическая обработка конфигурации


Развертывание пакетов App-V на одном компьютере или в пользовательском интерфейсе очень просто. Тем не менее, поскольку организации развертывают приложения AppV для бизнес-строк и географических и геограниц, возможность одновременных последовательностей приложения с одним набором параметров становится невозможной. Приложение App-V было спроектировано для этого сценария, так как оно собирает определенные параметры и конфигурации во время последовательности в файле манифеста, но также поддерживает изменение с динамическими файлами конфигурации.

Динамическая настройка App-V позволяет указать политику для пакета либо на уровне компьютера, либо на уровне пользователя. Динамические файлы конфигурации позволяют инженерам-последовательностью изменить конфигурацию пакета, после последовательной последовательности, чтобы удовлетворить потребности отдельных групп пользователей или компьютеров. В некоторых случаях может потребоваться внесение изменений в приложение для обеспечения надлежащей работы в среде App-V. Например, может потребоваться внесение изменений в файлы \ _ \ * config.xml, чтобы выполнить определенные действия в определенный момент во время выполнения приложения, например отключение расширения mailto, чтобы предотвратить перезапись расширения приложением из другого приложения.

Пакеты App-V содержат файл манифеста в файле пакета AppV, который является представителем последовательностей операций и является политикой выбора, если не назначены динамические файлы конфигурации определенному пакету. После последовательной последовательности файлов динамические файлы конфигурации можно изменить, чтобы разрешить публикацию приложения на разных компьютерах или пользователей с разными точками расширения. Два динамических файла конфигурации — это динамические конфигурации развертывания (DDC) и динамические файлы конфигурации (DUC). В этом разделе рассказывается о сочетаниях файлов манифеста и динамической конфигурации.

### Пример для динамических файлов конфигурации

В примере ниже показано сочетание манифеста, конфигурации развертывания и файлов конфигурации пользователя после публикации и выполнения обычной операции. Эти примеры являются сокращенными примерами каждого из файлов. Цель — это отображение только сочетаний файлов, а не полного описания конкретных категорий, доступных в каждом из файлов. Для получения дополнительной информации ознакомьтесь с руководством по виртуализации App-V 5 по адресу: <https://go.microsoft.com/fwlink/?LinkID=269810>

**Является**

```xml
<appv:Extension Category="AppV.Shortcut">
     <appv:Shortcut>
          <appv:File>[{Common Programs}]\7-Zip\7-Zip File Manager.lnk</appv:File>
          <appv:Target>[{AppVPackageRoot}]\7zFM.exe</appv:Target>
          <appv:Icon>[{AppVPackageRoot}]\7zFM exe.O.ico</appv:Icon>
     </appv:Shortcut>
</appv:Extension>
```

**Конфигурация развертывания**

```xml
<MachineConfiguration>
     <Subsystems>
          <Registry>
               <Include>
                    <Key Path= "\REGISTRY\Machine\Software\7zip">
                    <Value Type="REG_SZ" Name="Config" Data="1234"/>
                    </Key>
               </Include>
          </Registry>
     </Subsystems>
```

**Конфигурация пользователя**

```xml
<UserConfiguration>
     <Subsystems>
<appv:ExtensionCategory="AppV.Shortcut">
     <appv:Shortcut>
          <appv:File>[{Desktop}]\7-Zip\7-Zip File Manager.lnk</appv:File>
          <appv:Target>[{AppVPackageRoot}]\7zFM.exe</appv:Target>
          <appv:Icon>[{AppVPackageRoot}]\7zFM exe.O.ico</appv:Icon>
     </appv:Shortcut>
</appv:Extension>
     </Subsystems>
<UserConfiguration>
     <Subsystems>
<appv:Extension Category="AppV.Shortcut">
     <appv:Shortcut>
          <appv:Fìle>[{Desktop}]\7-Zip\7-Zip File Manager.lnk</appv:File>
          <appv:Target>[{AppVPackageRoot}]\7zFM.exe</appv:Target>
          <appv:Icon>[{AppVPackageRoot}]\7zFM.exe.O.ico</appv:Icon>
     </appv:Shortcut>
     <appv:Shortcut>
          <appv:File>[{Common Programs}]\7-Zip\7-Zip File Manager.Ink</appv:File>
          <appv:Target>[{AppVPackageRoot}]\7zFM.exe</appv:Target>
          <appv:Icon>[{AppVPackageRoot)]\7zFM.exe.O.ico</appv: Icon>
     </appv:Shortcut>
</appv:Extension>
     </Subsystems>
<MachineConfiguration>
     <Subsystems>
          <Registry>
               <Include>
                    <Key Path="\REGISTRY\Machine\Software\7zip">
                    <Value Type=”REG_SZ" Name="Config" Data="1234"/>
               </Include>
          </Registry>
     </Subsystems>
```

## <a href="" id="bkmk-sidebyside-assemblies"></a>Параллельные сборки


Приложение App-V поддерживает автоматическую упаковку параллельных сборок (SxS) во время виртуализации и развертывания на клиенте во время публикации виртуальных приложений. App-V 5 SP2 поддерживает сбор сборок SxS во время виртуализации для сборок, отсутствующих на компьютере, на котором установлена последовательность. И для сборок, состоящих из Visual C++ (версии 8 и более поздней) и во время выполнения MSXML, программа Sequencer автоматически обнаружит и захватит эти зависимости, даже если они не были установлены во время наблюдения. Функция "параллельные сборки" удаляет ограничения для предыдущих версий App-V, где приложение App-V Sequencer не захватывает сборки, уже присутствующие на рабочей станции, и privatizing сборки, для каждой из которых установлен ограниченный одноразрядный номер версии. Это поведение привело к развернутым приложениям App-V для клиентов, у которых нет требуемых сборок SxS, что приводит к сбою при запуске приложения. Таким образом, процесс упаковки будет применен к документу, а затем убедиться, что все сборки, необходимые для пакетов, были локально установлены в клиентской операционной системе пользователя, чтобы обеспечить поддержку виртуальных приложений. На основе числа сборок и нехватки документации приложения для необходимых зависимостей эта задача была как задачей для управления, так и ее реализации.

Поддержка параллельных сборок в App-V имеет перечисленные ниже возможности.

-   Автоматическое создание сборок SxS во время последовательности, независимо от того, была ли сборка уже установлена на рабочей станции.

-   Клиент App-V автоматически устанавливает на клиентский компьютер необходимые сборки SxS на момент публикации.

-   Секвенсор возвращает зависимость VC-времени выполнения в механизме составления отчетов секвенсора.

-   Секвенсор позволяет не упаковывать сборки, которые уже установлены в секвенсор, и поддерживать сценарии, в которых сборки ранее были установлены на целевые компьютеры.

### Автоматическая публикация сборок SxS

При публикации пакета App-V с сборками SxS клиент App-V будет проверять наличие сборки на компьютере. Если сборка не существует, клиент развернет сборку на компьютере. Пакеты, которые являются частью групп соединения, будут основываться на параллельных сборках сборок, которые являются частью основных пакетов, так как группа подключений не содержит сведений об установке сборки.

**Примечание**  Отмена публикации или удаление пакета с помощью сборки не приводит к удалению сборок для этого пакета.

 

## <a href="" id="bkmk-client-logging"></a>Ведение журнала на стороне клиента


Клиент App-V заносит данные в журнал событий Windows в стандартном формате ETW. Определенные события App-V можно найти в средстве просмотра событий в разделе приложения и службы Logs\\Microsoft\\AppV\\Client.

**Примечание**  В приложении App-V 5,0 с пакетом обновления 3 (SP3) некоторые журналы были консолидированы и перемещены в следующее расположение:

`Event logs/Applications and Services Logs/Microsoft/AppV/ServiceLog`

Список перемещенных журналов можно найти в разделе [о приложении App-V 5,0 SP3](about-app-v-50-sp3.md#bkmk-event-logs-moved).

 

Ниже описаны три определенные категории событий.

**Администратор**: регистрирует события для конфигураций, которые применяются к клиенту App-V и содержат основные предупреждения и ошибки.

**Эксплуатация**: заносит в журнал общее выполнение App-v и использование отдельных компонентов, создавая журнал аудита операций App-v, выполненных в клиенте App-v.

**Виртуальное приложение**: журналы записываются виртуальным приложением для запуска и использования подсистем виртуализации.






 

 





