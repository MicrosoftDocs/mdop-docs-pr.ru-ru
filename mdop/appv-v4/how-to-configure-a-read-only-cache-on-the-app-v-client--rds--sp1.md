---
title: Настройка "нередактируемого" кэша в клиенте App-V (RDS)
description: Настройка "нередактируемого" кэша в клиенте App-V (RDS)
author: dansimp
ms.assetid: b6607fe2-6f92-4567-99f1-d8e3c8a591e0
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, appcompat, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 08/30/2016
ms.openlocfilehash: a44844ae9ffc3497151be7713f6a43fda0ccd8fa
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/26/2020
ms.locfileid: "10817949"
---
# Настройка "нередактируемого" кэша в клиенте App-V (RDS)


**Важно!**  Для использования этой процедуры необходимо запустить App-V 4,6, SP1.

 

Вы можете развернуть клиент App-V с помощью общего кэша, заполняемого всеми приложениями, необходимыми для всех пользователей. Затем вы настраиваете клиентов служб удаленных рабочих столов App-V (RDS) для использования одного и того же файла кэша. Пользователи получают доступ к определенным приложениям с помощью процесса публикации App-V. Поскольку кэш уже предварительно загружен со всеми приложениями, потоковая передача не происходит, когда пользователь запускает приложение. Однако пакеты, используемые для предварительного заполнения кэша, должны быть помещены на сервер App-V, поддерживающий потоковую передачу по протоколу RTSP (Real Time Streaming Protocol) и предоставляющий разрешения на доступ клиентам App-V. Если вы публикуете приложения с помощью сервера управления App-V, вы можете использовать его для предоставления этой функции потоковой передачи.

**Примечание**  Сведения, описанные в этих процедурах, предназначены только для примера. Вы можете использовать различные методы для выполнения всего процесса.

 

## Развертывание клиента App-V в сценарии RDS


Процесс развертывания состоит из четырех основных задач:

-   Создание и заполнение основного файла общего кэша

-   Копирование файла общего кэша на серверное хранилище

-   Настройка клиентского программного обеспечения App-V

-   Управление циклом развертывания обновления для файла общего кэша после первоначального развертывания

Эти задачи требуют тщательного планирования. Мы рекомендуем вам подготовить и документировать methodical, воспроизводимый процесс, который будет подписаться в вашей организации. Это особенно важно для подготовки и развертывания файла основного общего кэша и для текущего управления обновлениями приложения, для каждого из которых требуется обновление основного общего кэша. Чтобы выполнить эти основные задачи, выполните указанные ниже действия.

**Примечание**  Несмотря на то, что вы можете опубликовать приложения с помощью нескольких различных методов, описанные ниже действия основаны на использовании сервера управления App-V для публикации.

 

**Настройка кэша только для чтения для первоначального развертывания**

1. Установка и настройка сервера управления App-V для предоставления поддержки проверки подлинности пользователей и публикации.

2. Заполните папку содержимого на этом сервере управления всеми пакетами приложений, необходимыми для всех пользователей.

3. Настройте промежуточный компьютер, на котором установлен клиент App-V. Войдите на промежуточный компьютер, используя учетную запись, которая имеет доступ ко всем приложениям, и вы сможете опубликовать на компьютере весь набор приложений, а затем перепотокировать приложения так, чтобы они были полностью загружены.

   **Важно.**  
   На промежуточном компьютере должны использоваться те же тип операционной системы и системная архитектура, что и для виртуальных машин, на которых работает клиент App-V.

     

4. Перезапустите промежуточный компьютер в безопасном режиме, чтобы убедиться, что драйверы не запущены, так как при этом файл кэша будет заблокирован.

   **Примечание.**  
   Кроме того, вы можете остановить и отключить службу Application Virtualization, а затем перезапустить компьютер. После копирования файла не забудьте включить и запустить службу еще раз.

     

5. Скопируйте файл кэша Sftfs. FSD в сеть хранения данных, в которой все серверы RDS смогут получать к ним доступ, например в общую папку. Настройте разрешения на доступ к папке "только для чтения" для групп "все" и "полный доступ" для администраторов, которые будут управлять обновлением файлов в кэше. Расположение файла кэша можно получить в реестре AppFS\\FileName.

   **Важно.**  
   Файл FSD необходимо разместить в том месте, где есть скорость отклика и надежность, равная локально подключенному хранилищу, например SAN.

     

6. Установите клиентскую RDS App-V на каждом сервере RDS и настройте его на использование кэша только для чтения, добавив следующие значения раздела реестра в раздел AppFS на клиенте. Клавиша AppFS расположена на странице HKEY \ _LOCAL \ _MACHINE \\SOFTWARE\\\] Microsoft\\SoftGrid\\4.5\\Client\\AppFS для 32-разрядных компьютеров и на странице HKEY \ _LOCAL \ _MACHINE \\SOFTWARE\\Wow6432Node\\Microsoft\\SoftGrid\\4.5\\Client\\AppFS для 64-разрядных компьютеров.

   <table>
   <colgroup>
   <col width="25%" />
   <col width="25%" />
   <col width="25%" />
   <col width="25%" />
   </colgroup>
   <thead>
   <tr class="header">
   <th align="left">Ключ</th>
   <th align="left">Тип</th>
   <th align="left">Значение</th>
   <th align="left">Описание</th>
   </tr>
   </thead>
   <tbody>
   <tr class="odd">
   <td align="left"><p>FileName</p></td>
   <td align="left"><p>Строка</p></td>
   <td align="left"><p>путь к FSD</p></td>
   <td align="left"><p>Задает путь к файлу общего кэша (например, \RDSServername\Sharefolder\SFTFS.). FSD (обязательный аргумент).</p></td>
   </tr>
   <tr class="even">
   <td align="left"><p>ReadOnlyFSD</p></td>
   <td align="left"><p>DWORD</p></td>
   <td align="left"><p>1,1</p></td>
   <td align="left"><p>Настраивает Клиент для работы в режиме "только для чтения". Это гарантирует, что клиент не попытается попытаться перенаправит обновления в кэш пакетов. (Обязательно)</p></td>
   </tr>
   <tr class="odd">
   <td align="left"><p>ErrorLogLocation</p></td>
   <td align="left"><p>Строка</p></td>
   <td align="left"><p>путь к файлу журнала ошибок (ETL-файла)</p></td>
   <td align="left"><p>Элемент, с помощью которого можно указать путь к журналу ошибок. Рекомендуется. Используйте локальный путь (например, C:\Logs\Sftfs.etl).</p></td>
   </tr>
   </tbody>
   </table>

     

7. Настройте каждый сервер RDS в ферме на использование сервера публикации и используйте обновление публикации при входе пользователей. Когда пользователи входят на серверы RDS, происходит цикл обновления публикации и публикуются все приложения, для которых их учетная запись авторизована. Эти приложения выполняются из общего кэша.

**Настройка клиента RDS для обновления пакета**

1.  Завершите обновление и тестирование пакета приложения.

2.  Обновите пакет на сервере App-V. Затем опубликуйте и поработайте в потоке новую версию приложения с клиентом на промежуточном компьютере, чтобы они были полностью загружены в кэш.

3.  Перезапустите промежуточный компьютер в безопасном режиме, чтобы убедиться, что драйверы не запущены.

    **Примечание**  Кроме того, вы можете сначала остановить и отключить службу Application Virtualization в службах Services. msc, а затем перезапустить компьютер. После копирования файла не забудьте включить и запустить службу еще раз.

     

4.  Скопируйте файл кэша Sftfs. FSD в сеть хранения данных, в которой все серверы RDS смогут получать к ним доступ, например в общую папку. Вы можете использовать другое имя файла, например SFTFS \ _V2. FSD, чтобы отличать новую версию.

5.  Чтобы настроить клиентские RDS App-V на каждом сервере RDS в ферме для использования обновленного файла общего кэша, измените значение FILENAME для раздела реестра AppFS таким образом, чтобы оно указывало на расположение обновленного файла, например \\\\RDSServername\\Sharefolder\\SFTFS\ _V2. FSD. Это гарантирует, что каждый сервер RDS получает обновленную копию кэша при перезапуске драйверов App-vClient.

    **Важно!**  Для использования обновленного файла общего кэша необходимо перезапустить серверы RDS.

     

## Использование символьных ссылок при обновлении кэша


Вместо того, чтобы изменять значение имени файла ключа AppFS каждый раз при развертывании нового файла кэша, содержащего новые или обновленные пакеты, можно использовать символьную ссылку в следующих операционных системах: Windows Vista, Windows 7 и Windows Server 2008. Дополнительные сведения о символических [ссылках см](https://go.microsoft.com/fwlink/?LinkId=157626) https://go.microsoft.com/fwlink/?LinkId=157626) . В отличие от этого, Windows XP не поддерживает использование символических ссылок, поэтому вместо них следует использовать точки соединения. Дополнительные сведения о соединениях можно найти в [статье 205524](https://go.microsoft.com/fwlink/?LinkId=182553) в базе знаний Майкрософт ( https://go.microsoft.com/fwlink/?LinkId=182553) а также на [1.05е](https://go.microsoft.com/fwlink/?LinkId=182554) с помощью средства v https://go.microsoft.com/fwlink/?LinkId=182554) .

**Настройка символьной ссылки для ссылки на кэш**

1.  На начальном этапе развертывания откройте окно командной строки в качестве локального администратора в операционной системе узла RDS-сервера.

2.  Создайте символьную ссылку с помощью команды MKLINK и настройте ее так, чтобы она указывала на файл Sftfs. fsd.

    **     mklink symlinkname \\\\rdshostserver\\sharefolder\\sftfs.fsd**

3.  В образе эталонной виртуальной машины VDI откройте окно командной строки с помощью команды " **Запуск от имени администратора** " и предоставьте разрешения удаленной ссылки таким образом, чтобы виртуальная машина могла получить доступ к символической ссылке в операционной системе сервера VDI. По умолчанию разрешения для удаленной ссылки отключены.

    **fsutil behavior Set SymlinkEvaluation R2R: 1**

    **Примечание**  На сервере хранилища должны быть включены соответствующие разрешения на ссылки. В зависимости от расположения ссылки и файла Sftfs. FSD разрешениями являются **L2L: 1** или **L2R: 1** или **r2l:** **1 или**.

     

4.  При настройке клиента App-V RDS задайте значение FILENAME для AppFS Key, равное UNC-пути к файлу FSD, использующему символьную ссылку. Например, задайте для имени файла \\\\VDIHostserver\\Symlinkname. Когда клиент App-V сначала пытается получить доступ к кэшу, символическая ссылка передает клиенту дескриптор файлу кэша. Клиент продолжает использовать этот дескриптор, пока клиент запущен. Значение символьной ссылки может безопасно обновляться даже в том случае, если для существующих клиентов открыт старый общий кэш.

5.  Если необходимо обновить пакет или добавить новый пакет в кэш, выполните действия 1 – 4 процедуры обновления. Затем удалите символьную ссылку и повторно создайте ее, чтобы она указывала на новую версию общего файла кэша. Это гарантирует, что каждый сервер RDS будет получать обновленную копию кэша при перезапуске клиентских драйверов App-V. После перезапуска сервера RDS клиент App-V получает дескриптор обновленной копии кэша, так как клиент использует путь, который содержит обновленную символьную ссылку. Затем пользователи смогут получить доступ к новым и обновленным приложениям.

## Статьи по теме


[Установка сервера Application Virtualization Management Server](how-to-install-application-virtualization-management-server.md)

[Установка клиента Application Virtualization Client вручную](how-to-manually-install-the-application-virtualization-client.md)

[Установка клиента с помощью командной строки](how-to-install-the-client-by-using-the-command-line-new.md)

 

 





