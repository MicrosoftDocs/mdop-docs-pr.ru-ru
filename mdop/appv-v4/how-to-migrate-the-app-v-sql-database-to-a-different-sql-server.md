---
title: Миграция базы данных SQL App-V на другой сервер SQL Server
description: Миграция базы данных SQL App-V на другой сервер SQL Server
author: dansimp
ms.assetid: 353892a1-9327-4489-a19c-4ec7bd1b736f
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, appcompat, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 06/16/2016
ms.openlocfilehash: e3d84b0cb328873db3722ad3eb9af6a2b442fdcf
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/26/2020
ms.locfileid: "10817072"
---
# Миграция базы данных SQL App-V на другой сервер SQL Server


Ниже описаны инструкции по переносу базы данных SQL сервера управления Microsoft Application Virtualization (App-V) на другой сервер SQL Server.

**Важно!**  Для этой процедуры требуется, чтобы служба App-V была остановлена, а конечные пользователи не смогут использовать свои приложения.

 

**Создание резервной копии базы данных SQL App-V**

1.  Откройте программу Services. msc и остановите службу сервера управления App-V на всех серверах управления, использующих эту базу данных для миграции.

2.  На компьютере, на котором находится база данных App-V, откройте центр SQL Server Management Studio.

3.  Разверните узел **базы данных** и найдите базу данных App-V (имя по умолчанию — APPVIRT).

4.  Щелкните правой кнопкой мыши базу данных и выберите **задачи** , а затем нажмите кнопку **создать резервную копию**.

5.  Убедитесь в том, что для **модели восстановления** задано значение **Simple** , а для **типа резервной копии** задано значение **полная**. При необходимости измените параметры **резервного** и **конечного** данных.

6.  Нажмите кнопку **ОК** , чтобы создать резервную копию базы данных. После успешного завершения архивации нажмите кнопку **ОК**.

7.  Откройте проводник и перейдите в папку, содержащую файл резервной копии базы данных, например APPVIRT. BAK. Скопируйте файл резервной копии базы данных на конечный компьютер, на котором работает SQL Server.

**Восстановление базы данных SQL App-V на конечном компьютере**

1.  На конечном компьютере откройте центр SQL Server Management Studio, щелкните правой кнопкой мыши узел **базы данных** и выберите команду **восстановить базу данных**.

2.  В разделе **источник для восстановления**выберите вариант **с устройства** и нажмите кнопку "**...".** .

3.  В диалоговом окне **Определение резервной копии** убедитесь, что на **носителе резервной копии** задан **файл** , а затем нажмите кнопку **Добавить**.

4.  Выберите файл резервной копии, который вы скопировали с исходного компьютера, на котором запущен SQL Server, и нажмите кнопку **ОК**.

5.  Нажмите кнопку **ОК** , а затем щелкните, чтобы выбрать резервную копию для восстановления.

6.  В разделе **назначение для восстановления**щелкните раскрывающийся список для **базы данных** и выберите имя базы данных App-V (например, APPVIRT).

7.  Нажмите кнопку **ОК** , чтобы начать восстановление. После успешного завершения восстановления нажмите кнопку **ОК**.

8.  Разверните узел **Безопасность** , щелкните правой кнопкой мыши **логины** и выберите команду **создать учетную запись**.

9.  В поле **имя для входа** введите сведения об учетной записи сетевой службы для сервера управления App-V в формате DOMAIN\\SERVERNAME $.

10. На странице **Общие** в разделе **база данных по умолчанию** выберите имя базы данных App-V (например, APPVIRT), а затем нажмите кнопку **ОК**.

11. В разделе **Выбор страницы**нажмите кнопку, чтобы выбрать страницу **сопоставления пользователей** . В разделе **Пользователи, сопоставленные с этим именем входа**, установите флажок в столбце **сопоставить** , чтобы выбрать базу данных App-V.

12. В разделе **членство в роли базы данных для: &lt; Appvdatabasename &gt; **выберите **SFTEveryone** и нажмите кнопку **ОК**.

13. Убедитесь в том, что брандмауэр Windows на новом компьютере, на котором запущен SQL Server, настроен так, чтобы сервер управления App-V мог получить доступ к системе. В разделе **средства администрирования**с помощью **брандмауэра Windows в приложении Advanced Security** можно создать **правило входящего трафика** для порта, используемого SQL Server (по умолчанию — это порт 1433).

**Миграция заданий агента SQL Server App-V**

1.  На исходном компьютере, на котором запущен SQL Server, в SQL Server Management Studio, разверните узел **агента SQL Server** , а затем разверните узел **задания** .

2.  Щелкните правой кнопкой мыши четыре задания App-V и выберите **Задание для сценария: | Создание | Файл**и сохраните каждый сценарий в папке и присвойте каждому из них описательное имя.

    -   **Журнал использования базы данных SoftGrid (appvdbname)**

    -   **База данных SoftGrid (appvdbname) закрытие потерянных сеансов**

    -   **База данных SoftGrid (appvdbname) принудительное ограничение размера**

    -   **Управление базой данных SoftGrid (appvdbname) отслеживание состояния уведомлений и заданий**

3.  Скопируйте четыре файла сценария (SQL) на конечный компьютер, на котором работает SQL Server, и откройте центр SQL Server Management Studio.

4.  В проводнике щелкните каждый из файлов SQL правой кнопкой мыши и выберите команду **выполнить**. Каждый сценарий откроется в окне запроса в SQL Server Management Studio. Нажмите кнопку **выполнить** для каждого сценария и убедитесь, что все выполнены успешно.

5.  Обновите узел **задания** под узлом **агента SQL Server** и убедитесь, что четыре задания успешно созданы.

**Обновление конфигурации сервера управления App-V**

1.  На сервере управления App-V измените указанные ниже разделы реестра.

    -   **SQLServerName**  =  SQLSERVERNAME &lt; newservername&gt;

    -   **SQLServerPort**  =  SQLServerPort &lt; newserverport&gt;

    Затем перезапустите службу App-V Server.

2.  Найдите файл SftMgmt. UDL в каталоге установки сервера App-V (по умолчанию — C:\\program Files Files\\Microsoft приложение System Center virt Management Service Server\\App-virt Management). Щелкните файл правой кнопкой мыши и выберите команду **Открыть**.

3.  На вкладке **Подключение** введите имя конечного компьютера, на котором запущен SQL Server, и нажмите кнопку **проверить подключение**. При успешном завершении проверки нажмите кнопку **ОК** , а затем еще раз нажмите кнопку **ОК** .

4.  В версиях сервера управления App-V до 4,5 с пакетом обновления 2 (SP2) необходимо обновить параметры ведения журнала SQL. В разделе **группы серверов**щелкните правой кнопкой мыши группу серверов, в которую входит сервер, и выберите пункт **свойства**.

5.  На вкладке **ведение журнала** выберите запись **базы данных SQL** и нажмите кнопку **изменить**.

6.  Измените **имя узла DNS** на имя узла нового компьютера, на котором запущен SQL Server, и нажмите кнопку **ОК**. Дважды нажмите кнопку **ОК** , а затем перезапустите службу App-V Server.

7.  Откройте консоль управления App-V, щелкните правой кнопкой мыши узел **приложения** и выберите команду **Обновить**. Список приложений должен отображаться так, как раньше.

 

 





