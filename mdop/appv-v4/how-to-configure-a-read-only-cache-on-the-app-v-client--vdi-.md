---
title: Настройка "нередактируемого" кэша в клиенте App-V (VDI)
description: Настройка "нередактируемого" кэша в клиенте App-V (VDI)
author: dansimp
ms.assetid: 7a41e017-9e23-4a6a-a659-04d23f008b83
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, appcompat, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 08/30/2016
ms.openlocfilehash: 114f9dfbf55a3f62b6bc8bec6b37a659ffbfaf56
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/26/2020
ms.locfileid: "10817942"
---
# Настройка "нередактируемого" кэша в клиенте App-V (VDI)


В Microsoft Application Virtualization (App-V) 4,6 клиент поддерживает использование общего кэша, доступного только для чтения. Общий доступ только для чтения позволяет клиенту эффективно использовать дисковое пространство в системе инфраструктуры виртуальных рабочих столов (VDI), где пользователи выполняют приложения на виртуальных машинах (ВМ), которые размещаются в среде центра обработки данных и совместно используют сетевое хранилище в сети SAN. Ниже описаны действия, которые необходимо выполнить для реализации клиента App-V в одной из основных архитектур VDI, называемой "poold VM" или "static VM". Предполагается, что вы знакомы с планированием, развертыванием и эксплуатацией системы App-V и ее компонентов, а также работой и управлением сервером VDI. Дополнительные сведения о приложении App-V можно найти в разделе [Application Virtualization](https://go.microsoft.com/fwlink/?LinkId=122939) (https://go.microsoft.com/fwlink/?LinkId=122939)

**Примечание**  Сведения, описанные в этих процедурах, предназначены только для примера. Вы можете использовать различные методы для выполнения всего процесса.

 

## Развертывание клиента App-V в сценарии VDI


Вы можете развернуть клиент App-V в сценарии VDI с помощью общего кэша, доступного только для чтения, который заполнен всеми необходимыми приложениями для всех пользователей. Затем настройте основной образ виртуальной машины VDI таким образом, чтобы все клиенты App-V использовали один и тот же кэш-файл. Пользователи получают доступ к определенным приложениям с помощью процесса публикации App-V. Поскольку кэш уже предварительно загружен со всеми приложениями, потоковая передача не происходит, когда пользователь запускает приложение. Однако пакеты, используемые для предварительного заполнения кэша, должны быть помещены на сервер App-V, поддерживающий потоковую передачу по протоколу RTSP (Real Time Streaming Protocol) и предоставляющий разрешения на доступ клиентам App-V. Если вы публикуете приложения с помощью сервера управления App-V, вы можете использовать его для предоставления этой функции потоковой передачи.

Процесс развертывания состоит из четырех основных задач:

-   Создание и заполнение основного файла общего кэша

-   Копирование файла общего кэша в хранилище сервера VDI

-   Настройка клиентского программного обеспечения App-V на эталонном образе VDI

-   Управление циклом развертывания обновления для файла общего кэша после первоначального развертывания

Эти задачи требуют тщательного планирования. Мы рекомендуем вам подготовить и документировать methodical, воспроизводимый процесс, который будет подписаться в вашей организации. Это особенно важно для первоначальной подготовки и развертывания файла основного общего кэша, а также для управления обновлениями приложения, для каждого из которых требуется обновление основного общего кэша. Чтобы выполнить эти основные задачи, выполните указанные ниже действия.

**Примечание**  Несмотря на то, что вы можете публиковать приложения несколькими различными способами, описанные ниже процедуры основываются на использовании сервера управления App-V для публикации.

 

**Настройка кэша только для чтения для первоначального развертывания в сценарии объединения виртуальной машины в составе пула или статической виртуальной машины в VDI**

1. Установка и настройка сервера управления App-V в виртуальной машине на сервере VDI для предоставления поддержки проверки подлинности пользователей и публикации.

2. Заполните папку содержимого на этом сервере управления всеми пакетами приложений, необходимыми для всех пользователей.

3. Настройте промежуточный компьютер, на котором установлен клиент App-V. Войдите на промежуточный компьютер с учетной записью, у которой есть доступ ко всем приложениям, чтобы на компьютере были опубликованы все необходимые приложения, а затем перезапустите кэширование приложений, чтобы они были полностью загружены.

   **Важно.**  
   На промежуточном компьютере должны использоваться те же тип операционной системы и системная архитектура, что и для виртуальных машин, на которых работает клиент App-V.

     

4. Перезапустите промежуточный компьютер в безопасном режиме, чтобы убедиться, что драйверы не запущены, и файл кэша блокируется.

   **Примечание.**  
   Кроме того, вы можете остановить и отключить службу Application Virtualization, а затем перезапустить компьютер. После копирования файла не забудьте включить и запустить службу еще раз.

     

5. Скопируйте файл кэша Sftfs. FSD в сеть хранения данных сервера VDI, в которой все виртуальные компьютеры смогут получать к ним доступ, например в общую папку. Настройте разрешения на доступ к папке "только для чтения" для групп "все" и "полный доступ" для администраторов, которые будут управлять обновлением файлов в кэше. Расположение файла кэша можно получить в реестре AppFS\\FileName.

   **Важно.**  
   Файл FSD необходимо разместить в том месте, где есть скорость ответа и надежность, эквивалентные локальному подключению хранилища (например, сети SAN).

     

6. Установите классическое приложение App-V на основной образ виртуальной машины VDI и настройте его на использование кэша только для чтения, добавив следующие значения раздела реестра в раздел AppFS на клиенте. Клавиша AppFS находится в разделе HKEY \ _LOCAL \ _MACHINE \\SOFTWARE\\\ [Wow6432Node\\\] Microsoft\\SoftGrid\\4.5\\Client\\AppFS.

   <table>
   <colgroup>
   <col width="25%" />
   <col width="25%" />
   <col width="25%" />
   <col width="25%" />
   </colgroup>
   <thead>
   <tr class="header">
   <th align="left">Ключ</th>
   <th align="left">Тип</th>
   <th align="left">Значение</th>
   <th align="left">Описание</th>
   </tr>
   </thead>
   <tbody>
   <tr class="odd">
   <td align="left"><p>FileName</p></td>
   <td align="left"><p>Строка</p></td>
   <td align="left"><p>путь к FSD</p></td>
   <td align="left"><p>Задает путь к файлу общего кэша (например, \VDIServername\Sharefolder\SFTFS.). FSD (обязательный аргумент).</p></td>
   </tr>
   <tr class="even">
   <td align="left"><p>ReadOnlyFSD</p></td>
   <td align="left"><p>DWORD</p></td>
   <td align="left"><p>1,1</p></td>
   <td align="left"><p>Настраивает Клиент для работы в режиме "только для чтения". Это гарантирует, что клиент не попытается попытаться передать обновления в кэш пакетов. (Обязательно)</p></td>
   </tr>
   <tr class="odd">
   <td align="left"><p>ErrorLogLocation</p></td>
   <td align="left"><p>Строка</p></td>
   <td align="left"><p>путь к файлу журнала ошибок (ETL)</p></td>
   <td align="left"><p>Элемент, с помощью которого можно указать путь к журналу ошибок. Рекомендуется. Используйте локальный путь (например, C:\Logs\Sftfs.etl).</p></td>
   </tr>
   </tbody>
   </table>

     

7. Настройте основной клиент образов виртуальных машин на использование сервера публикации и используйте обновление публикации при входе. Когда пользователи входят в систему VDI и их виртуальные машины строятся на основе главного образа виртуальной машины, происходит цикл обновления публикации и публикуются все приложения, для которых их учетная запись авторизована. Эти приложения выполняются из общего кэша.

**Настройка клиента для обновления пакета в сценарии для виртуальной машины из пула**

1.  Завершите обновление и тестирование пакета приложения.

2.  Обновите пакет на сервере App-V. Затем опубликуйте и поработайте в потоке новую версию приложения с клиентом на промежуточном компьютере, чтобы они были полностью загружены в кэш.

3.  Перезапустите промежуточный компьютер в безопасном режиме, чтобы убедиться, что драйверы не запущены.

    **Примечание**  Кроме того, вы можете остановить и отключить службу Application Virtualization в службах Services. msc, а затем перезапустить компьютер. После копирования файла не забудьте включить и запустить службу еще раз.

     

4.  Скопируйте файл кэша Sftfs. FSD в сеть хранения данных сервера VDI, в которой все виртуальные компьютеры смогут получать к ним доступ, например в общую папку. Вы можете использовать другое имя файла, например SFTFS \ _V2. FSD, чтобы отличать новую версию.

5.  Чтобы настроить клиент App-V для настольных компьютеров на образе виртуальной машины VDI для использования обновленного файла общего кэша, измените значение FILENAME для раздела реестра AppFS таким образом, чтобы он указывал на расположение обновленного файла, например \\\\VDIServername\\Sharefolder\\SFTFS\ _V2. FSD. Когда пользователь выходит из системы и снова входит в систему, для них создается новая виртуальная машина с помощью обновленного основного образа. Все параметры пользователя будут сохранены и применены к новой виртуальной машине. У них есть доступ к обновленным приложениям.

**Настройка клиента для обновления пакета в сценарии статической виртуальной машины**

1.  Завершите обновление и тестирование пакета приложения.

2.  Обновите пакет на сервере App-V. Затем опубликуйте и поработайте в потоке новую версию приложения на тестовом компьютере, чтобы приложения были полностью загружены в кэш.

3.  Перезапустите промежуточный компьютер в безопасном режиме, чтобы убедиться, что драйверы не запущены.

    **Примечание**  Кроме того, вы можете остановить и отключить службу Application Virtualization в службах Services. msc, а затем перезапустить компьютер. После копирования файла не забудьте включить и запустить службу еще раз.

     

4.  Скопируйте файл кэша Sftfs. FSD в сеть хранения данных сервера VDI, в которой все виртуальные компьютеры смогут получать к ним доступ, например в общую папку. Вы можете использовать другое имя файла, например SFTFS \ _V2. FSD, чтобы отличать новую версию.

5.  Чтобы настроить клиент App-V для настольных компьютеров на образе виртуальной машины VDI для использования обновленного файла общего кэша, измените значение FILENAME для раздела реестра AppFS таким образом, чтобы он указывал на расположение обновленного файла, например \\\\VDIServername\\Sharefolder\\SFTFS\ _V2. FSD. Это гарантирует, что новые пользователи получат новую версию.

6.  Создайте сценарий, который редактирует значение имени файла ключа AppFS, чтобы задать для него расположение обновленного кэша, например \\\\VDIServername\\Sharefolder\\SFTFS\ _V2. FSD. Настройте этот сценарий, чтобы он выполнялся, когда пользователь выходит из системы или входит в систему, чтобы он выполнялся перед запуском клиентских драйверов App-V, например с помощью параметров групповой политики. Когда пользователь выходит из системы и снова входит в систему, будет обновлена Текущая виртуальная машина, и они будут использовать обновленную копию кэша. После этого у них будет доступ к обновленным приложениям.

## Использование символьных ссылок при обновлении кэша


Вместо того чтобы изменять значение имени файла ключа AppFS каждый раз при развертывании нового файла кэша, содержащего новые или обновленные пакеты, можно использовать символьную ссылку в следующих операционных системах: Windows Vista, Windows 7 и Windows Server 2008. Дополнительные сведения о символических [ссылках см](https://go.microsoft.com/fwlink/?LinkId=157626) https://go.microsoft.com/fwlink/?LinkId=157626) . В отличие от этого, Windows XP не поддерживает использование символических ссылок, поэтому вместо них следует использовать точки соединения. Дополнительные сведения о соединениях можно найти в [статье 205524](https://go.microsoft.com/fwlink/?LinkId=182553) в базе знаний Майкрософт ( https://go.microsoft.com/fwlink/?LinkId=182553) а также на [1.05е](https://go.microsoft.com/fwlink/?LinkId=182554) с помощью средства v https://go.microsoft.com/fwlink/?LinkId=182554) .

**Настройка символьной ссылки для ссылки на кэш**

1.  На начальном этапе развертывания откройте окно командной строки как локальный администратор в операционной системе сервера VDI.

2.  Создайте символьную ссылку с помощью команды MKLINK и настройте ее так, чтобы она указывала на файл Sftfs. fsd.

    **     mklink symlinkname \\\\vdihostserver\\sharefolder\\sftfs.fsd**

3.  В образе эталонной виртуальной машины VDI откройте окно командной строки с помощью команды " **Запуск от имени администратора** " и предоставьте разрешения удаленной ссылки таким образом, чтобы виртуальная машина могла получить доступ к символической ссылке в операционной системе сервера VDI. По умолчанию разрешения для удаленной ссылки отключены.

    **fsutil behavior Set SymlinkEvaluation R2R: 1**

    **Примечание**  На сервере хранилища должны быть включены соответствующие разрешения на ссылки. В зависимости от расположения ссылки и файла Sftfs. FSD разрешениями являются **L2L: 1** или **L2R: 1** или **r2l:** **1 или**.

     

4.  Когда вы настраиваете клиент App-V для настольных компьютеров на образе основной виртуальной машины VDI, задайте для AppFS key значение FILENAME, равное UNC-пути к файлу FSD, использующему символьную ссылку. Например, установите для него значение \\\\VDIHostserver\\Symlinkname. Когда клиент App-V сначала пытается получить доступ к кэшу, символическая ссылка передает клиенту дескриптор файлу кэша. Клиент продолжает использовать этот дескриптор, пока клиент запущен. Значение символьной ссылки может безопасно обновляться даже в том случае, если для существующих клиентов открыт старый общий кэш.

5.  Если необходимо обновить пакет или добавить новый пакет в кэш, выполните действия 1 – 5 процедуры обновления для сценария static VM или пула ВМ. Затем удалите символьную ссылку и повторно создайте ее, чтобы она указывала на новую версию общего файла кэша. После перезапуска виртуальной машины клиент получает дескриптор обновленной копии кэша, так как виртуальная машина использует путь, который содержит обновленную символьную ссылку. Затем пользователи смогут получить доступ к новым и обновленным приложениям.

## Статьи по теме


[Установка сервера Application Virtualization Management Server](how-to-install-application-virtualization-management-server.md)

[Установка клиента Application Virtualization Client вручную](how-to-manually-install-the-application-virtualization-client.md)

[Установка клиента с помощью командной строки](how-to-install-the-client-by-using-the-command-line-new.md)

 

 





