---
title: Управление автоматическими обновлениями для рабочих областей MED-V
description: Управление автоматическими обновлениями для рабочих областей MED-V
author: dansimp
ms.assetid: 306f28a2-d653-480d-b737-4b8b3132de5d
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 08/30/2016
ms.openlocfilehash: b22d3250db806e740c1d62da4fed98d5956b0eeb
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/26/2020
ms.locfileid: "10825292"
---
# Управление автоматическими обновлениями для рабочих областей MED-V


Рабочая область MED-V — это виртуальная машина, которая содержит отдельную операционную систему, в которой должен управлять процесс автоматического обновления программного обеспечения, как и физические компьютеры в вашей организации. Поскольку гостевая операционная система не всегда должна выполняться при запуске операционной системы узла, необходимо убедиться в том, что виртуальная машина MED-V настроена таким образом, что при необходимости можно применять обновления программного обеспечения к гостевой операционной системе. Решение для Microsoft Enterprise Virtualization (MED-V) 2,0 предоставляет функциональные возможности, позволяющие определить, как автоматические обновления программного обеспечения обрабатываются в рабочей области MED-V.

## Управление политикой пробуждения MED-V в рабочей области


Политика пробуждения MED-V обеспечивает доступность виртуальной машины MED-V для обновлений в течение времени, указанного в параметрах конфигурации для MED-V. Это относится к обновлениям, опубликованным из Microsoft с помощью центра обновления Windows, а также обновлений, развернутых и управляемых решениями сторонних разработчиков, например антивирусными приложениями.

**Важно!**  Политика пробуждения для рабочей области MED-V оптимизирована для инфраструктуры центра обновления Майкрософт. Если вы используете Microsoft System Center Configuration Manager для развертывания обновлений, не относящихся к корпорации Майкрософт, рекомендуется также использовать приложение System Center Updates Publisher, которое использует преимущества той же инфраструктуры, что и центр обновления Майкрософт, и, следовательно, преимущества из политики пробуждения MED-V. Дополнительные сведения можно найти в разделе [Microsoft System Center Updates Publisher](https://go.microsoft.com/fwlink/?LinkId=200035) ( https://go.microsoft.com/fwlink/?LinkId=200035) .

 

Когда вы создаете пакет рабочей области для MED-V, вы настроили время и способ начала работы, когда пользователь входит в систему (**Быстрый запуск**) или когда пользователь впервые открывает опубликованное приложение (**обычное начало**). Или установите флажок, чтобы конечный пользователь мог управлять этим параметром.

В обоих случаях, когда выбран параметр **быстрого запуска** , виртуальная машина продолжает работать, пока узел MED-V вошел в систему как пользователь. В этой конфигурации, так как MED-V активна, если узел активен, автоматические обновления применяются без необходимости дополнительной обработки из MED-V.

Однако для тех случаев, когда **быстрое начало** не задано или переход на другой компьютер или спящий режим из рабочей области MED-v гарантирует, что операционная система на виртуальной машине регулярно обновляется даже в том случае, если med-v не используется регулярно. MED-V выполняет эту функцию путем регулярного пробуждения виртуальной машины в соответствии с указанными параметрами конфигурации. Это позволит выполнять клиенты автоматических обновлений на виртуальной машине в соответствии с их конфигурацией.По истечении периода времени, определенного параметром конфигурации MED-V, MED-V возвращает виртуальную машину в предыдущее состояние.

**Примечание**  Если конечный пользователь открывает опубликованное приложение в течение периода обновления, применяются необходимые обновления, но MED-V не переключается в спящий режим и не закрывается по окончании срока действия обновления. Вместо этого MED-V продолжает работу.

 

Политика пробуждения для рабочей области MED-V включает три основных компонента:

**Диспетчер гостевых обновлений**

Этот автономный исполняемый файл, находящийся на узле MED-V, отвечает за пробуждение виртуальной машины в соответствии с предопределенным настраиваемым расписанием. Укажите параметры конфигурации, указывающие, когда диспетчер обновлений должен выводить виртуальную машину каждый день, а также время, в течение которого виртуальная машина должна находиться в спящем режиме (в минутах), чтобы разрешить применение обновлений. После того как указанное количество минут было достигнуто, диспетчер гостевых обновлений переводит виртуальную машину в спящий режим, подготовленный для следующего использования. Вы можете запланировать выполнение исполняемой программы с помощью диспетчера задач Windows.

**Служба управления перезапуском гостя**

У этой услуги есть три основные обязанности, находящиеся на узле MED-V. Кроме того, с помощью гостевого центра обновления вы управляете перезапуском виртуальной машины при входе пользователя, если это необходимо. Она обнаруживает, когда требуется перезагрузка виртуальной машины из – за установки обновлений. Кроме того, это гарантирует, что задача для диспетчера гостевых обновлений будет всегда планироваться согласно настройке.

**Служба гостевых обновлений**

На виртуальной машине MED-V эта служба Windows несет ответственность за наблюдение за установкой обновлений, требующих перезапуска. После того как служба сознает необходимость перезапуска, она уведомляет службу управления перезапуском гостя на узле.

### Параметры конфигурации для политики пробуждения рабочей области для MED-V

Вы можете управлять тем, когда и как долго виртуальная машина должна получать автоматические обновления, определяя следующие два значения конфигурации в реестре. Оба этих значения находятся под ключом HKLM\\Software\\Microsoft\\MEDV\\v2\\VM.

**GuestUpdateTime** — настраивается час и минута, когда MED-V должен пробудить виртуальную машину для обновления, основываясь на стандарте 24-часового времени. Укажите время в формате чч: мм. Значение по умолчанию — 00:00 (полночь).

**GuestUpdateDuration** — настраивает количество минут, в течение которых MED-V должен поддерживать обновление виртуальной машины в спящем режиме для обновления, начиная с указанного в параметре GuestUpdateTime конфигурации. Значение по умолчанию — 240 (4 часа). Установка этого значения равным нулю (0) отключает политику пробуждения MED-V.

Дополнительные сведения о том, как определить значения конфигурации MED-V, можно найти в разделе [Управление параметрами конфигурации в рабочей области для MED-v](managing-med-v-workspace-configuration-settings.md).

**Примечание**  Для работы с помощью MED-V рекомендуется настроить интервал пробуждения таким образом, чтобы он соответствовал времени, в течение которого виртуальные машины MED-V планируется обновлять регулярно. Кроме того, рекомендуется настроить эти параметры таким образом, чтобы они соответствовали поведению хост-компьютера.

 

### Уведомление о перезагрузке с использованием системы ESD

Вы можете настроить систему ESD для уведомления MED-V каждый раз, когда требуется перезагрузка для рабочей области MED-V после применения автоматических обновлений. При применении автоматических обновлений с помощью системы ESD, для которой требуется перезагрузка, необходимо написать сценарий, сообщающий о следующем глобальном событии в рабочей области MED-V.

**Важно!**  Вы должны открыть событие с правами только на изменение и подать ему сигнал. Если вы не откроете его с правильными разрешениями, это не повлияет на работу.

 

``` syntax
/// <summary>
/// The guest is required to be restarted due to an ESD update.
/// </summary>
public const string MedvGuestRebootRequiredEventName = @"Global\MedvGuestRebootRequiredEvent";
using (EventWaitHandle notificationEvent = 
EventWaitHandle.OpenExisting(eventName, EventWaitHandleRights.Modify))
{
notificationEvent.Set();
}
```

Когда вы сообщаете о событии, MED-V захватывает его и информирует виртуальную машину о необходимости перезагрузки.

## Статьи по теме


[Управление обновлениями программного обеспечения для рабочих областей MED-V](managing-software-updates-for-med-v-workspaces.md)

 

 





