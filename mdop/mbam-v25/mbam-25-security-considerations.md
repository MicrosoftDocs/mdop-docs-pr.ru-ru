---
title: Процедуры безопасности MBAM 2.5
description: Процедуры безопасности MBAM 2.5
author: dansimp
ms.assetid: f6613c63-b32b-45fb-a6e8-673d6dae7d16
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, security
ms.mktglfcycl: manage
ms.sitesec: library
ms.prod: w10
ms.date: 04/23/2017
ms.openlocfilehash: 86a756ab6f983fa1f22de6835b5993e1215d1dbe
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/26/2020
ms.locfileid: "10826839"
---
# Процедуры безопасности MBAM 2.5


В этой статье приведены сведения о том, как защитить администрирование и мониторинг Microsoft BitLocker (MBAM).

-   [Настройка MBAM для депонирования доверенного платформенного модуля и хранения паролей OwnerAuth](#bkmk-tpm)

-   [Настройка MBAM для автоматической разблокировки доверенного платформенного модуля после блокировки](#bkmk-autounlock)

-   [Безопасные соединения с SQL Server](#bkmk-secure-databases)

-   [Создание учетных записей и групп](#bkmk-accts-groups)

-   [Использование файлов журнала MBAM](#bkmk-logfiles)

-   [Рассмотрение вопросов, которые следует учитывать при TDEии базы данных MBAM](#bkmk-tde)

-   [Общие сведения о вопросах безопасности](#bkmk-general-security)

## <a href="" id="bkmk-tpm"></a>Настройка MBAM для депонирования доверенного платформенного модуля и хранения паролей OwnerAuth

**Примечание** В Windows 10 версии 1607 или более поздней права собственности на этот доверенный платформенный модуль могут получить только Windows. Кроме того, Windows не сохранит пароль владельца доверенного платформенного модуля при подготовке доверенного платформенного модуля. Дополнительные сведения приведены в разделе [пароль владельца доверенного платформенного модуля](https://docs.microsoft.com/windows/security/information-protection/tpm/change-the-tpm-owner-password) .

В зависимости от конфигурации доверенный платформенный модуль (TPM) сам блокирует себя в некоторых ситуациях ─ (например, при вводе слишком большого количества недопустимых паролей ─) и может оставаться заблокированным в течение определенного периода времени. При блокировке доверенного платформенного модуля BitLocker не может получить доступ к ключам шифрования для выполнения операций разблокировки и расшифровки, требуя от пользователя ввода ключа восстановления BitLocker для доступа к диску операционной системы. Чтобы сбросить блокировку доверенного платформенного модуля, необходимо предоставить пароль OwnerAuth доверенного платформенного модуля.

MBAM может хранить пароль OwnerAuth доверенного платформенного модуля в базе данных MBAM, если он владеет доверенным платформенным модулем или его пароль. После этого на веб-сайте администрирования и мониторинга OwnerAuth пароли легко доступны для восстановления из блокировки доверенного платформенного модуля, что устраняет необходимость дождаться разрешения блокировки.

### Депонирование OwnerAuth TPM в Windows 8 и более новых версиях

**Примечание** В Windows 10 версии 1607 или более поздней права собственности на этот доверенный платформенный модуль могут получить только Windows. В addiiton при подготовке доверенного платформенного модуля Windows не сохранит пароль владельца доверенного платформенного модуля. Дополнительные сведения приведены в разделе [пароль владельца доверенного платформенного модуля](https://docs.microsoft.com/windows/security/information-protection/tpm/change-the-tpm-owner-password) .

В Windows 8 или более новой версия MBAM больше не должна владеть TPM для хранения пароля OwnerAuth, если OwnerAuth доступен на локальном компьютере.

Чтобы включить MBAM в депонированный и сохранить пароли OwnerAuth доверенного платформенного модуля, необходимо настроить эти параметры групповой политики.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Параметр групповой политики</th>
<th align="left">Конфигурация</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Включение резервного копирования доверенного платформенного модуля в доменные службы Active Directory</p></td>
<td align="left"><p>Отключено или не настроено</p></td>
</tr>
<tr class="even">
<td align="left"><p>Настройка уровня доступности данных авторизации владельца доверенного платформенного модуля для операционной системы</p></td>
<td align="left"><p>Делегированный/отсутствует или не настроен</p></td>
</tr>
</tbody>
</table>

 

Расположение этих параметров групповой политики является **конфигурацией компьютера** &gt; **шаблоны** &gt; **System** &gt; **служб доверенных платформенных модулей**системы.

**Примечание**  Windows удаляет OwnerAuth локально после того, как MBAM успешно поменяет эти параметры.

 

### Депонирование OwnerAuth TPM в Windows 7

В Windows 7 MBAM должен владеть доверенным платформенным модулем для автоматического депонирования OwnerAuth в базе данных MBAM. Если MBAM не владеет доверенным платформенным модулем, необходимо использовать командлеты импорта данных MBAM Active Directory (AD), чтобы скопировать OwnerAuth доверенного платформенного модуля из Active Directory в базу данных MBAM.

### MBAM командлетов импорта данных Active Directory

Командлеты импорта данных MBAM Active Directory позволяют получить пакеты ключей восстановления и пароли OwnerAuth, которые хранятся в Active Directory.

Сервер MBAM 2,5 с пакетом обновления 1 (SP1) поставляется с четырьмя командлетами PowerShell, которые предварительно заполнили MBAM базы данных с данными о восстановлении тома и владельцами TPM, хранящимся в Active Directory.

Для ключей и пакетов восстановления тома:

-   Чтение и ADRecoveryInformation

-   Write-MbamRecoveryInformation

Для сведений о владельце доверенного платформенного модуля:

-   Чтение и ADTpmInformation

-   Write-MbamTpmInformation

Чтобы связать пользователей с компьютерами, выполните указанные ниже действия.

-   Write-MbamComputerUser

Командлеты Read-AD \ * читают данные из Active Directory. Командлеты Write-MBAM \ * помещают данные в базы данных MBAM. Подробные сведения об этих командлетах, включая синтаксис, параметры и примеры, приведены в [справочнике по командлетам для администрирования Microsoft BitLocker и наблюдения за 2,5](https://technet.microsoft.com/library/dn459018.aspx) .

**Создание ассоциаций пользователей и компьютеров.** Командлеты импорта данных MBAM Active Directory собирают данные из Active Directory и вставляют их в базу данных MBAM. Однако они не связывают пользователей с томами. Вы можете скачать Add-ComputerUser.ps1 сценарий PowerShell для создания ассоциаций пользователей и компьютеров, которые позволят пользователям восстановить доступ к компьютеру с помощью веб-сайта администрирования и мониторинга либо с помощью портала самообслуживания для восстановления. Сценарий Add-ComputerUser.ps1 собирает данные из **управляемого** атрибута в Active Directory (AD), владельца объекта в AD или из настраиваемого CSV-файла. Затем сценарий добавляет обнаруженные пользователи в объект конвейера данных для восстановления, который должен быть передан в MbamRecoveryInformation записи для вставки данных в базу данных восстановления.

Скачайте сценарий PowerShell Add-ComputerUser.ps1 из [центра загрузки Майкрософт](https://go.microsoft.com/fwlink/?LinkId=613122).

Вы можете указать **справку Add-ComputerUser.ps1** , чтобы получить справку по сценарию, в том числе примеры использования командлетов и сценария.

Для создания ассоциаций пользователей и компьютеров после установки сервера MBAM используйте командлет PowerShell Write-MbamComputerUser. Как и в случае с Add-ComputerUser.ps1 сценария PowerShell, этот командлет позволяет указать пользователей, которые могут использовать портал самообслуживания для получения информации о OwnerAuth доверенного платформенного модуля или паролях восстановления тома для указанного компьютера.

**Примечание**  Агент MBAM переопределит сопоставления пользователей и компьютеров, когда компьютер начнет выводить отчет на сервер.

 

**Необходимые условия:** С помощью командлетов Read-AD \ * можно получать данные из AD только в том случае, если они работают как учетная запись пользователя с высокой привилегией, например администратор домена, или под учетной записью в пользовательской группе безопасности, которой предоставлен доступ на чтение данных (рекомендуемый вариант).

[Руководство по работе с шифрованием диска BitLocker: восстановление зашифрованных томов в доменных службах Active](https://technet.microsoft.com/library/cc771778(WS.10).aspx) Directory предоставляет подробные сведения о создании настраиваемой группы безопасности (или нескольких групп) с правом на чтение сведений о рекламе.

**MBAM и разрешения на запись веб-службы восстановления и оборудования.** Командлеты Write-MBAM \ * допускают URL-адрес службы восстановления и оборудования MBAM, который используется для публикации сведений о восстановлении или TPM. Обычно только учетная запись службы компьютера домена может взаимодействовать со службой восстановления и оборудования MBAM. В MBAM 2,5 с пакетом обновления 1 (SP1) можно настроить службу восстановления MBAM и оборудования с помощью группы безопасности DataMigrationAccessGroup, члены которой могут пропустить проверку учетной записи службы компьютера домена. Командлеты Write-MBAM \ * должны выполняться от имени пользователя, принадлежащего данной настроенной группе. (Кроме того, вы можете задать учетные данные отдельного пользователя в настроенной группе с помощью параметра – Credential в командлетах Write-MBAM \ *.)

Настроить MBAM и службу оборудования с именем этой группы безопасности можно одним из указанных ниже способов.

-   Укажите имя группы безопасности (или отдельного пользователя) в параметре-DataMigrationAccessGroup командлета PowerShell Enable-MbamWebApplication-AgentService.

-   Настройте группу после установки MBAM восстановления и оборудования, изменив файл web.config в &lt; &gt; папке Inetpub \\Microsoft BitLocker Solution\\Recovery и Service\\ оборудования.

    ```xml
    <add key="DataMigrationUsersGroupName" value="<groupName>|<empty>" />
    ```

    где &lt; GroupName &gt; заменяется доменом и именем группы (или отдельным пользователем), которое будет использоваться для миграции данных из Active Directory.

-   С помощью редактора конфигурации в диспетчере IIS измените этот appSetting.

В приведенном ниже примере команда, запускаемая как член группы "ADRecoveryInformation" и "Пользователи миграции данных", будет получать сведения о восстановлении тома с компьютеров в подразделении рабочих станций (OU) в домене contoso.com и записывать их в MBAM с помощью MBAM службы восстановления и оборудования, запущенного на сервере mbam.contoso.com.

``` syntax
PS C:\> Read-ADRecoveryInformation -Server contoso.com -SearchBase "OU=WORKSTATIONS,DC=CONTOSO,DC=COM" | Write-MbamRecoveryInformation -RecoveryServiceEndPoint "https://mbam.contoso.com/MBAMRecoveryAndHardwareService/CoreService.svc"
```

**Командлеты Read-AD \ *** допускают имя или IP-адрес компьютера, на котором размещается сервер службы каталогов Active Directory, для запроса сведений о восстановлении или TPM. Мы рекомендуем указывать отличительные имена контейнеров Active Directory, в которых объект компьютера находится в качестве значения параметра SearchBase. Если компьютеры хранятся в нескольких подразделениях, командлеты могут допускать входные данные конвейера для выполнения для каждого контейнера. Отличительное имя контейнера рекламных объявлений будет выглядеть примерно так, как OU = Machines, DC = contoso, DC = com. Выполнение поиска, ориентированного на конкретные контейнеры, обеспечивает следующие преимущества:

-   Уменьшает риск истечения времени ожидания при запросе большого набора данных рекламных объявлений для объектов компьютера.

-   Можно опустить OU, содержащие серверы Datacenter или другие классы компьютеров, для которых резервная копия может быть нежелательным или необходимой.

Кроме того, для поиска объектов компьютера по всем контейнерам, которые должны быть в указанном SearchBase или в целом домене, можно задать для параметра – рекурсивный флаг с необязательными SearchBase или без него. Если вы используете параметр-MaxPageSize, вы также можете использовать для управления объемом локальной и удаленной памяти, необходимой для обслуживания запроса.

Эти командлеты записываются в объекты конвейера типа PsObject. Каждый экземпляр PsObject имеет один ключ восстановления тома или строку владельца доверенного платформенного модуля с соответствующим именем компьютера, меткой времени и другими данными, необходимыми для ее публикации в хранилище данных MBAM.

**Командлеты Write-MBAM \ *** допускают значения параметров сведений о восстановлении из конвейера по имени свойства. Это позволяет командлетам Write-MBAM \ * допускать выходные данные конвейера для командлетов Read-AD (например, Read-ADRecoveryInformation – Server contoso.com — рекурсия | Пишите — MbamRecoveryInformation – RecoveryServiceEndpoint mbam.contoso.com).

**Командлеты Write-MBAM \ *** включают необязательные параметры, предоставляющие параметры для обеспечения отказоустойчивости, протоколирования и настройки для WhatIf и подтверждения.

**Командлеты Write-MBAM \ *** также включают дополнительный параметр *времени* , значение которого является объектом **DateTime** . Этот объект содержит атрибут *типа* , для которого может быть задано значение `Local` , `UTC` или `Unspecified` . При заполнении параметра *time* из данных, полученных из службы каталогов Active Directory, время преобразуется в формат UTC, и *этот атрибут этого* свойства устанавливается автоматически `UTC` . Однако при заполнении параметра *time* с помощью другого источника, такого как текстовый файл, необходимо явным образом задать для атрибута *типа* нужное значение.

**Примечание**  Командлеты для чтения и AD не могут найти учетные записи пользователей, которые представляют пользователей компьютера. Сопоставления учетной записи пользователя необходимы для указанных ниже действий.

-   Восстановление паролей и пакетов тома с помощью портала самообслуживания

-   Пользователи, которые не входят в группу безопасности "Расширенные справочные пользователи MBAM" в соответствии с определением во время установки, восстанавливая от имени других пользователей.

 

## <a href="" id="bkmk-autounlock"></a>Настройка MBAM для автоматической разблокировки доверенного платформенного модуля после блокировки


Вы можете настроить MBAM 2,5 с пакетом обновления 1 (SP1), чтобы автоматически разблокировать доверенный платформенный модуль в случае блокировки. Если функция автоматического сброса блокировки доверенного платформенного модуля включена, MBAM может определить, что пользователь заблокирован, и получить пароль OwnerAuth из базы данных MBAM для автоматической разблокировки доверенного платформенного модуля для пользователя. Функция автоматического сброса блокировки доверенного платформенного модуля доступна только в том случае, если ключ восстановления операционной системы для этого компьютера был получен с помощью портала самообслуживания или веб-сайта администрирования и мониторинга.

**Важно!**  Чтобы включить Автосброс блокировки доверенного платформенного модуля, необходимо настроить эту функцию как на стороне сервера, так и в групповой политике на стороне клиента.

 

-   Чтобы включить Автосброс блокировки доверенного платформенного модуля на стороне клиента, настройте параметр групповой политики "Настройка автоматического сброса блокировки доверенного платформенного модуля" в разделе " **Конфигурация компьютера** " " &gt; **шаблоны** &gt; **Windows** для &gt; **MBAM** &gt; **управления клиентами**".

-   Чтобы включить функцию автоматического сброса блокировки доверенного платформенного модуля на стороне сервера, вы можете установить флажок "включить Автосброс блокировки доверенного платформенного модуля" в мастере настройки сервера MBAM во время установки.

    Кроме того, вы можете включить функцию автоматического сброса блокировки доверенного платформенного модуля в PowerShell с помощью переключателя "-Автоматический сброс блокировки TPM" во время включения веб-компонента службы агента.

После того как пользователь введет ключ восстановления BitLocker, полученный на портале самообслуживания или на веб-сайте администрирования и мониторинга, агент MBAM определит, блокируется ли доверенный платформенный модуль. Если он заблокирован, он попытается получить OwnerAuth доверенного платформенного модуля для компьютера из базы данных MBAM. Если доверенный платформенный модуль OwnerAuth успешно получен, он будет использоваться для разблокировки доверенного платформенного модуля. При разблокировании ДОВЕРЕНного платформенного модуля доверенный ПЛАТФОРМЕНный модуль становится полнофункциональным, и пользователю не будет принудительно вводить пароль восстановления во время последующих перезагрузок из блокировки доверенного платформенного модуля.

Функция автоматического сброса блокировки доверенного платформенного модуля отключена по умолчанию.

**Примечание**  Функция автоматического сброса блокировки доверенного платформенного модуля поддерживается только на компьютерах с доверенным платформенным модулем версии 1,2. Доверенный платформенный модуль 2,0 обеспечивает встроенную функцию автоматического сброса блокировки.

 

**Отчет аудита восстановления** содержит события, связанные с автоматическим сбросом блокировки ДОВЕРЕНного платформенного модуля. Если запрос получен из клиента MBAM, чтобы получить пароль OwnerAuth TPM, событие заносится в журнал для указания на восстановление. Записи аудита будут включать следующие события:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Вход</th>
<th align="left">Значение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Источник запросов аудита</p></td>
<td align="left"><p>Разблокировка доверенного платформенного модуля агента</p></td>
</tr>
<tr class="even">
<td align="left"><p>Тип ключа</p></td>
<td align="left"><p>Хеш пароля доверенного платформенного модуля</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Описание причины</p></td>
<td align="left"><p>Сброс доверенного платформенного модуля</p></td>
</tr>
</tbody>
</table>

 

## <a href="" id="bkmk-secure-databases"></a>Безопасные соединения с SQL Server


В MBAM SQL Server обменивается данными со службами отчетов SQL Server и веб-службами для веб-сайтов администрирования и мониторинга и портала самообслуживания. Мы рекомендуем защитить связь с SQL Server. Дополнительные сведения можно найти [в разделе Шифрование подключений к SQL Server](https://technet.microsoft.com/library/ms189067.aspx).

Дополнительные сведения о защите веб-сайтов MBAM можно найти [в разделе Планирование безопасности веб-сайтов MBAM](planning-how-to-secure-the-mbam-websites.md).

## <a href="" id="bkmk-accts-groups"></a>Создание учетных записей и групп


Рекомендации по управлению учетными записями пользователей — это создание глобальных групп домена и добавление в них учетных записей пользователей. Описание рекомендуемых учетных записей и групп смотрите в разделе [планирование для групп и учетных записей MBAM 2,5](planning-for-mbam-25-groups-and-accounts.md).

## <a href="" id="bkmk-logfiles"></a>Использование файлов журнала MBAM


В этом разделе описаны файлы журнала клиентов MBAM Server и MBAM.

**Файлы журнала установки MBAM Server**

Файл **MBAMServerSetup.exe** создает следующие файлы журнала в папке **% TEMP%** во время установки MBAM:

-   **Microsoft \ _BitLocker \ _Administration \ _and \ _Monitoring \ _ &lt; 14 числа &gt; . log**

    Записываются в журнал действия, выполненные во время настройки MBAM и конфигурации компонентов сервера MBAM.

-   **Microsoft \ _BitLocker \ _Administration \ _and \ _Monitoring \ _ &lt; 14 \ _numbers &gt;\_0\_MBAMServer.msi. log**

    Заносит в журнал дополнительные действия, выполненные во время установки.

**Файлы журнала конфигурации сервера MBAM**

-   **Журналы приложений и служб/Microsoft Windows/MBAM-Setup**

    Заносит в журнал ошибки, возникающие при использовании командлетов Windows PowerShell или мастера настройки сервера MBAM, для настройки функций сервера MBAM.

**Файлы журнала установки клиента MBAM**

-   **MSI &lt; пять случайных знаков &gt; . log**

    Записываются в журнал действия, которые выполняются во время установки клиента MBAM.

**MBAM — файлы журнала веб-сайта**

-   Показывает активность из веб-порталов и служб.

## <a href="" id="bkmk-tde"></a>Рассмотрение вопросов, которые следует учитывать при TDEии базы данных MBAM


Функция шифрования прозрачных данных (TDE), доступная в SQL Server, является дополнительной установкой для экземпляров базы данных, на которых будут размещаться функции базы данных MBAM.

С помощью TDE можно выполнять полное шифрование на уровне базы данных в режиме реального времени. TDE — это оптимальный вариант массового шифрования для соответствия требованиям законодательства и корпоративным стандартам безопасности данных. TDE работает на уровне файлов, что аналогично двум функциям Windows: шифрованной файловой системе (EFS) и шифрованию диска BitLocker. Обе функции также шифруют данные на жестком диске. TDE не заменяет шифрование на уровне ячейки, EFS и BitLocker.

Если в базе данных включена TDE, все резервные копии шифруются. Таким образом, чтобы убедиться в том, что сертификат, использовавшийся для защиты ключа шифрования базы данных, должен быть архивирован и поддерживаться с резервной копией базы данных. Если сертификат (или сертификаты) теряется, данные не будут прочитаны.

Создавайте резервные копии сертификата вместе с базой данных. Каждая резервная копия сертификата должна содержать два файла. Оба этих файла должны быть архивированы. В идеале для обеспечения безопасности их следует архивировать отдельно из файла резервной копии базы данных. Вы также можете использовать функцию расширенного управления ключами (Extensible Key Management) (расширенное управление ключами) для хранения и обслуживания ключей, используемых для TDE.

Пример включения TDE для экземпляров базы данных MBAM можно найти в разделе [Общие сведения о шифровании прозрачных данных (TDE)](https://technet.microsoft.com/library/bb934049.aspx).

## <a href="" id="bkmk-general-security"></a>Общие сведения о вопросах безопасности


**Общие сведения о рисках для системы безопасности.** Наиболее серьезный риск при использовании администрирования Microsoft BitLocker и наблюдение за тем, что его функциональность может получить неавторизованный пользователь, который может затем повторно настроить шифрование диска BitLocker и получить данные ключа шифрования BitLocker на клиентах MBAM. Тем не менее функция MBAM в течение короткого промежутка времени из-за атаки типа "отказ в обслуживании" обычно не имеет катастрофического воздействия, в отличие от того, например, потери электронной почты или сетевого соединения или Power.

**Физическая защита компьютеров**. Безопасность не имеет физического уровня безопасности. Злоумышленник, которому удается получить доступ к серверу MBAM, может использовать его для атаки на всю клиентскую базу. Все потенциальные физическая атака должны считаться очень риском и соответствующим образом устранены. Серверы MBAM должны храниться в надежной серверной комнате с управляемым доступом. Защитите эти компьютеры, если администраторы не находятся в физическом режиме, с помощью операционной системы и запирания компьютера или защищенной экранной заставки.

**Установка последних обновлений для системы безопасности на всех компьютерах**. Получайте сведения о новых обновлениях для операционных систем Windows, SQL Server и MBAM, подписавшись на службу уведомлений безопасности на [техническом центре безопасности](https://go.microsoft.com/fwlink/?LinkId=28819).

**Используйте надежные пароли и передавайте фразы**. Всегда используйте надежные пароли с 15 и более символами для всех учетных записей администраторов MBAM. Никогда не используйте пустые пароли. Дополнительные сведения о работе с паролями можно найти в разделе [Политика паролей](https://technet.microsoft.com/library/hh994572.aspx).



## Статьи по теме


[Планирование развертывания MBAM 2.5](planning-to-deploy-mbam-25.md)

 
## У вас есть предложение MBAM?
- Здесь вы можете добавить предложения и проголосовать [здесь](http://mbam.uservoice.com/forums/268571-microsoft-bitlocker-administration-and-monitoring).
- Для MBAM проблемы используйте [MBAM Форум TechNet](https://social.technet.microsoft.com/Forums/home?forum=mdopmbam).
 





